---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import CodeItem from '../components/CodeItem.astro';
import GameCard from '../components/GameCard.astro';
import Footer from '../components/Footer.astro';

interface GameData {
  slug: string;
  name: string;
  thumbnail: string;
  description: string;
  metaTitle: string;
  metaDescription: string;
  lastUpdated: string;
  activeCodes: { code: string; reward: string; addedDate?: string }[];
  expiredCodes: { code: string; reward: string }[];
  howToRedeem: string[];
  noCodeSystem?: boolean;
  noCodeNote?: string;
  introText?: string;
  whatAreCodes?: string;
  howToGetCodes?: string;
  playerCount?: number;
  totalVisits?: number;
  likes?: number;
  favourites?: number;
  genre?: string;
  placeId?: number;
  universeId?: number;
  developer?: string;
}

export async function getStaticPaths() {
  const gameModules = import.meta.glob<GameData>('../../data/games/*.json', {
    eager: true,
    import: 'default',
  });

  const allGames = Object.values(gameModules);

  return allGames.map((game) => ({
    params: { slug: game.slug },
    props: { game, allGames },
  }));
}

const { game, allGames } = Astro.props;

// Pick 4 random related games with active codes
const candidates = (allGames as GameData[]).filter(
  (g) => g.slug !== game.slug && g.activeCodes.length > 0
);
for (let i = candidates.length - 1; i > 0; i--) {
  const j = Math.floor(Math.random() * (i + 1));
  [candidates[i], candidates[j]] = [candidates[j], candidates[i]];
}
const relatedGames = candidates.slice(0, 4);

const dateLabel = new Date(game.lastUpdated).toLocaleDateString('es-ES', {
  day: 'numeric',
  month: 'long',
  year: 'numeric',
});

function formatNumber(n: number): string {
  if (n >= 1_000_000_000) return `${(n / 1_000_000_000).toFixed(1).replace('.0', '')}B`;
  if (n >= 1_000_000) return `${(n / 1_000_000).toFixed(1).replace('.0', '')}M`;
  if (n >= 1_000) return `${(n / 1_000).toFixed(1).replace('.0', '')}K`;
  return n.toString();
}

const validThumb = game.thumbnail && game.thumbnail.startsWith('https://tr.rbxcdn.com');

function isNewCode(addedDate?: string): boolean {
  if (!addedDate) return false;
  const added = new Date(addedDate);
  const diffMs = Date.now() - added.getTime();
  return diffMs < 3 * 24 * 60 * 60 * 1000; // 3 days
}

// Fallback SEO texts — use JSON field if present, otherwise generate from data
const favCount = game.favourites || game.likes || 0;
const devName = game.developer || '';
const genreLabel = game.genre && game.genre !== 'All' ? ` de ${game.genre}` : '';
const visitsLabel = game.totalVisits ? `más de ${formatNumber(game.totalVisits)} visitas` : '';
const favsLabel = favCount ? `${formatNumber(favCount)} favoritos` : '';
const statsPhrase = [visitsLabel, favsLabel].filter(Boolean).join(' y ');

const introContent = game.introText
  || `${game.name} es un juego${genreLabel} en Roblox${devName ? ` creado por ${devName}` : ''}. ${statsPhrase ? `El juego tiene ${statsPhrase}. ` : ''}Actualmente tenemos ${game.activeCodes.length} código${game.activeCodes.length !== 1 ? 's' : ''} activo${game.activeCodes.length !== 1 ? 's' : ''} y ${game.expiredCodes.length} código${game.expiredCodes.length !== 1 ? 's' : ''} expirado${game.expiredCodes.length !== 1 ? 's' : ''} para ${game.name}.`;

const whatAreCodesContent = game.whatAreCodes
  || `Los códigos de ${game.name} son combinaciones de texto que puedes canjear dentro del juego para obtener recompensas gratuitas como monedas, gemas, potenciadores y objetos exclusivos sin gastar Robux.`;

const howToGetCodesContent = game.howToGetCodes
  || `Guarda esta página en favoritos porque la actualizamos regularmente.${devName ? ` También puedes seguir a ${devName} en Roblox para enterarte de los nuevos códigos.` : ''} Los códigos suelen publicarse en el Discord del juego y con cada actualización.`;

const mesesES = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
const now = new Date();
const mesAnio = `${mesesES[now.getMonth()]} ${now.getFullYear()}`;
const isRoblox = !!(game.placeId);
const robloxLabel = isRoblox ? ' Roblox' : '';
const displayName = game.name.startsWith('Códigos') ? game.name : `Códigos ${game.name}`;
const imgAlt = game.name.startsWith('Códigos') ? `${game.name} Roblox` : `Códigos ${game.name} Roblox`;
const activeCount = game.activeCodes.length;

const dynamicTitle = `Códigos ${game.name}${robloxLabel} (${mesAnio}) — Códigos Gratis`;
const dynamicDescription = activeCount > 0
  ? `Códigos actualizados de ${game.name}${robloxLabel} para ${mesAnio}. ${activeCount} códigos activos verificados. Canjea recompensas gratis ahora. ¡Lista actualizada hoy!`
  : `Códigos de ${game.name}${robloxLabel} para ${mesAnio}. Consulta todos los códigos activos y expirados. ¡Actualizamos a diario!`;

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: `¿Cuáles son los códigos activos de ${game.name}?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text:
          game.activeCodes.length > 0
            ? `Los códigos activos de ${game.name} son: ${game.activeCodes.map((c) => c.code).join(', ')}.`
            : `Actualmente no hay códigos activos para ${game.name}. Revisamos a diario y actualizamos esta página en cuanto se publican nuevos códigos.`,
      },
    },
    {
      '@type': 'Question',
      name: `¿Cómo canjear códigos en ${game.name}?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: game.howToRedeem.length > 0
          ? game.howToRedeem.map((step, i) => `${i + 1}. ${step}`).join(' ')
          : `Abre ${game.name} en Roblox, busca el botón de códigos en el menú del juego, escribe o pega el código y pulsa Canjear.`,
      },
    },
    {
      '@type': 'Question',
      name: `¿Por qué no funcionan los códigos de ${game.name}?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: `Los códigos de ${game.name} pueden no funcionar por varios motivos: el código ha expirado y ya no es válido, hay un error tipográfico al escribirlo (copia y pega para evitarlo), o ya lo has canjeado anteriormente en tu cuenta, ya que cada código solo se puede usar una vez.`,
      },
    },
  ],
};
---

<Layout
  title={dynamicTitle}
  description={dynamicDescription}
  ogImage={validThumb ? game.thumbnail : undefined}
>
  <script
    slot="head"
    type="application/ld+json"
    set:html={JSON.stringify(faqSchema)}
  />

  <Header />

  <main class="main">
    <div class="page-wrap">
      <!-- Breadcrumbs -->
      <nav class="breadcrumbs">
        <a href="/">Inicio</a>
        <svg class="breadcrumbs__sep" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
        <span>Códigos de {game.name}</span>
      </nav>

      <!-- Hero -->
      <section class="hero">
        {validThumb && (
          <div class="hero__bg">
            <img src={game.thumbnail} alt="" class="hero__bg-img" loading="eager" />
            <div class="hero__bg-overlay"></div>
          </div>
        )}
        <div class="hero__content">
          <div class="hero__img-wrap">
            {validThumb ? (
              <img
                src={game.thumbnail}
                alt={imgAlt}
                class="hero__img"
                loading="eager"
              />
            ) : (
              <div class="hero__placeholder">
                <span class="hero__placeholder-text">{game.name}</span>
              </div>
            )}
          </div>
          <div class="hero__info">
            <h1 class="hero__title">{displayName}</h1>
            <p class="hero__desc">{game.description}</p>
            <div class="hero__badges">
              {game.noCodeSystem ? (
                <span class="badge badge--dim">Sin sistema de códigos</span>
              ) : (
                <a href="#codigos" class="badge badge--green badge--link">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                  {game.activeCodes.length} código{game.activeCodes.length !== 1 && 's'} activo{game.activeCodes.length !== 1 && 's'}
                </a>
              )}
              <span class="badge badge--yellow">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                Actualizado {dateLabel}
              </span>
            </div>
          </div>
        </div>
      </section>

      <!-- Stats -->
      {(game.playerCount || game.totalVisits || game.likes || game.favourites) && (
        <div class="stats">
          {game.playerCount && (
            <div class="stat">
              <div class="stat__icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              </div>
              <span class="stat__value">{formatNumber(game.playerCount)}</span>
              <span class="stat__label">Jugando ahora</span>
            </div>
          )}
          {game.totalVisits && (
            <div class="stat">
              <div class="stat__icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
              </div>
              <span class="stat__value">{formatNumber(game.totalVisits)}</span>
              <span class="stat__label">Visitas totales</span>
            </div>
          )}
          {game.favourites && (
            <div class="stat">
              <div class="stat__icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
              </div>
              <span class="stat__value">{formatNumber(game.favourites)}</span>
              <span class="stat__label">Favoritos</span>
            </div>
          )}
          {game.likes && !game.favourites && (
            <div class="stat">
              <div class="stat__icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>
              </div>
              <span class="stat__value">{formatNumber(game.likes)}</span>
              <span class="stat__label">Likes</span>
            </div>
          )}
        </div>
      )}

      <!-- Fisch Companion banner (solo para codigos-fisch) -->
      {game.slug === 'codigos-fisch' && (
        <a href="/games/fisch/" class="fisch-banner">
          <div class="fisch-banner__icon">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#22D3EE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.46-3.44 6-7 6-3.56 0-7.56-2.54-8.5-6Z"/><path d="M3 12l3.5-3v6L3 12Z"/><circle cx="16" cy="10" r="1" fill="#22D3EE" stroke="none"/></svg>
          </div>
          <div class="fisch-banner__body">
            <span class="fisch-banner__title">Explorar Fisch Companion</span>
            <span class="fisch-banner__desc">1,235+ peces, calculadoras, value list y más</span>
          </div>
          <svg class="fisch-banner__arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
        </a>
      )}

      <!-- Intro -->
      <section class="section">
        <p class="intro-text">{introContent}</p>
      </section>

      <!-- Aviso: sin sistema de códigos -->
      {game.noCodeSystem && game.noCodeNote && (
        <section class="section">
          <div class="no-codes-notice">
            <svg class="no-codes-notice__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            <p class="no-codes-notice__text">{game.noCodeNote}</p>
          </div>
        </section>
      )}

      <!-- Códigos activos -->
      {game.activeCodes.length > 0 && (
        <section class="section" id="codigos">
          <div class="section__header">
            <h2 class="section__title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
              Códigos activos
            </h2>
            <span class="codes-check">Verificado {dateLabel}</span>
          </div>
          <div class="codes-list">
            {game.activeCodes.map((c) => (
              <CodeItem code={c.code} reward={c.reward} isNew={isNewCode(c.addedDate)} />
            ))}
          </div>
        </section>
      )}

      <!-- ¿Qué son los códigos? -->
      <section class="section">
        <h2 class="section__title section__title--plain">¿Qué son los códigos de {game.name}?</h2>
        <p class="section__text">{whatAreCodesContent}</p>
      </section>

      <!-- Códigos expirados -->
      {game.expiredCodes.length > 0 && (
        <section class="section">
          <div class="section__header">
            <h2 class="section__title section__title--dim">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
              Códigos expirados
            </h2>
          </div>
          <div class="codes-list">
            {game.expiredCodes.map((c) => (
              <CodeItem code={c.code} reward={c.reward} expired />
            ))}
          </div>
        </section>
      )}

      <!-- Cómo canjear -->
      {game.howToRedeem.length > 0 && (
        <section class="section">
          <h2 class="section__title section__title--plain">Cómo canjear códigos</h2>
          <div class="redeem-box">
            <ol class="redeem-steps">
              {game.howToRedeem.map((step) => (
                <li class="redeem-steps__item">{step}</li>
              ))}
            </ol>
            {game.placeId && (
              <a
                href={`https://www.roblox.com/games/${game.placeId}`}
                target="_blank"
                rel="noopener noreferrer"
                class="roblox-link"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                Abrir {game.name} en Roblox
              </a>
            )}
          </div>
        </section>
      )}

      <!-- ¿Cómo conseguir más códigos? -->
      <section class="section">
        <h2 class="section__title section__title--plain">¿Cómo conseguir más códigos de {game.name}?</h2>
        <p class="section__text">{howToGetCodesContent}</p>
      </section>

      <!-- ¿Por qué no funcionan los códigos? -->
      <section class="section">
        <h2 class="section__title section__title--plain">¿Por qué no funcionan los códigos?</h2>
        <div class="reasons-box">
          <ul class="reasons-list">
            <li><strong>El código ha expirado:</strong> los desarrolladores desactivan códigos sin previo aviso. Consulta nuestra lista de códigos expirados más arriba.</li>
            <li><strong>Error al escribirlo:</strong> copia y pega el código directamente para evitar errores tipográficos. Las mayúsculas y minúsculas importan.</li>
            <li><strong>Ya lo canjeaste antes:</strong> cada código solo se puede usar una vez por cuenta.</li>
            <li><strong>Tu cuenta no cumple los requisitos:</strong> algunos códigos requieren un nivel mínimo o haber completado cierto tutorial.</li>
          </ul>
        </div>
      </section>

      <!-- Tabla sobre el juego -->
      {(game.genre || game.totalVisits || game.likes || game.favourites || game.developer || game.placeId) && (
        <section class="section">
          <h2 class="section__title section__title--plain">Sobre {game.name}</h2>
          <div class="info-table-wrap">
            <table class="info-table">
              <tbody>
                {game.developer && (
                  <tr>
                    <td class="info-table__label">Desarrollador</td>
                    <td class="info-table__value">{game.developer}</td>
                  </tr>
                )}
                {game.genre && game.genre !== 'All' && (
                  <tr>
                    <td class="info-table__label">Género</td>
                    <td class="info-table__value">{game.genre}</td>
                  </tr>
                )}
                {game.totalVisits && (
                  <tr>
                    <td class="info-table__label">Visitas totales</td>
                    <td class="info-table__value">{game.totalVisits.toLocaleString('es-ES')}</td>
                  </tr>
                )}
                {game.favourites && (
                  <tr>
                    <td class="info-table__label">Favoritos</td>
                    <td class="info-table__value">{game.favourites.toLocaleString('es-ES')}</td>
                  </tr>
                )}
                {game.likes && !game.favourites && (
                  <tr>
                    <td class="info-table__label">Likes</td>
                    <td class="info-table__value">{game.likes.toLocaleString('es-ES')}</td>
                  </tr>
                )}
                {game.placeId && (
                  <tr>
                    <td class="info-table__label">Enlace Roblox</td>
                    <td class="info-table__value">
                      <a href={`https://www.roblox.com/games/${game.placeId}`} target="_blank" rel="noopener noreferrer" class="info-table__link">
                        Jugar en Roblox
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                      </a>
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>
        </section>
      )}

      <!-- Más juegos con códigos -->
      {relatedGames.length > 0 && (
        <section class="section">
          <h2 class="section__title section__title--plain">Más juegos con códigos</h2>
          <div class="related-grid">
            {relatedGames.map((g) => (
              <GameCard
                name={g.name}
                slug={g.slug}
                image={g.thumbnail}
                activeCodes={g.activeCodes.length}
                lastUpdated={g.lastUpdated}
              />
            ))}
          </div>
        </section>
      )}
    </div>
  </main>

  <Footer />
</Layout>

<style>
  .main {
    padding: 1rem 0 3rem;
  }

  @media (min-width: 640px) {
    .main { padding-top: 2rem; }
  }

  .page-wrap {
    width: 100%;
    max-width: 760px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  /* ---- Fisch Companion Banner ---- */
  .fisch-banner {
    display: flex;
    align-items: center;
    gap: 0.85rem;
    padding: 0.9rem 1.15rem;
    background: rgba(34, 211, 238, 0.06);
    border: 1px solid rgba(34, 211, 238, 0.18);
    border-radius: 12px;
    margin-bottom: 1.25rem;
    transition: border-color 0.2s, background 0.2s, transform 0.2s;
  }

  .fisch-banner:hover {
    border-color: rgba(34, 211, 238, 0.4);
    background: rgba(34, 211, 238, 0.1);
    transform: translateY(-1px);
  }

  .fisch-banner__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(34, 211, 238, 0.1);
    border-radius: 10px;
    flex-shrink: 0;
  }

  .fisch-banner__body {
    flex: 1;
    min-width: 0;
  }

  .fisch-banner__title {
    display: block;
    font-size: 0.9rem;
    font-weight: 700;
    color: #22D3EE;
  }

  .fisch-banner__desc {
    display: block;
    font-size: 0.78rem;
    color: var(--text-dim);
    margin-top: 2px;
  }

  .fisch-banner__arrow {
    color: var(--text-dim);
    flex-shrink: 0;
    transition: transform 0.2s, color 0.2s;
  }

  .fisch-banner:hover .fisch-banner__arrow {
    color: #22D3EE;
    transform: translateX(4px);
  }

  /* ---- Breadcrumbs ---- */
  .breadcrumbs {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.78rem;
    color: var(--text-dim);
    margin-bottom: 0.75rem;
  }

  @media (min-width: 640px) {
    .breadcrumbs { font-size: 0.85rem; margin-bottom: 1.25rem; }
  }

  .breadcrumbs a {
    color: var(--text-dim);
    text-decoration: none;
    transition: color 0.2s;
  }

  .breadcrumbs a:hover {
    color: var(--accent);
  }

  .breadcrumbs__sep {
    color: var(--text-dim);
    opacity: 0.4;
    flex-shrink: 0;
  }

  /* ---- Hero ---- */
  .hero {
    position: relative;
    border-radius: 14px;
    overflow: hidden;
    margin-bottom: 1.5rem;
    border: 1px solid var(--border);
    background: var(--bg-card);
  }

  .hero__bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .hero__bg-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: blur(10px) saturate(1.2) brightness(0.5);
    transform: scale(1.15);
  }

  .hero__bg-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(10,15,28,0.6) 0%, rgba(10,15,28,0.45) 100%);
  }

  .hero__content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 0.85rem;
    padding: 0.85rem;
  }

  .hero__img-wrap {
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.1);
    background: var(--bg-card);
    flex-shrink: 0;
    width: 80px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  }

  .hero__img {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    display: block;
  }

  .hero__placeholder {
    width: 100%;
    aspect-ratio: 1 / 1;
    background: linear-gradient(135deg, #1a2236 0%, #1e3a5f 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
  }

  .hero__placeholder-text {
    font-family: var(--font-display);
    font-size: 0.9rem;
    font-weight: 700;
    color: #fff;
    text-align: center;
    line-height: 1.2;
    opacity: 0.9;
  }

  .hero__info {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    min-width: 0;
    flex: 1;
  }

  .hero__title {
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 800;
    line-height: 1.2;
  }

  .hero__desc {
    color: rgba(241, 245, 249, 0.7);
    font-size: 0.85rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  @media (min-width: 480px) {
    .hero__content { padding: 1rem; }
    .hero__img-wrap { width: 110px; }
    .hero__title { font-size: 1.45rem; }
    .hero__desc { -webkit-line-clamp: 3; }
  }

  @media (min-width: 640px) {
    .hero { border-radius: 16px; }
    .hero__content { gap: 1.25rem; padding: 1.25rem; }
    .hero__img-wrap { width: 180px; border-radius: 12px; }
    .hero__title { font-size: 1.85rem; }
    .hero__desc { font-size: 0.95rem; -webkit-line-clamp: unset; display: block; }
    .hero__placeholder-text { font-size: 1.5rem; }
  }

  .hero__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
    margin-top: 0.25rem;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-family: var(--font-display);
    font-size: 0.68rem;
    font-weight: 700;
    padding: 0.2rem 0.6rem;
    border-radius: 9999px;
  }

  @media (min-width: 640px) {
    .hero__badges { gap: 0.5rem; margin-top: 0.35rem; }
    .badge { font-size: 0.76rem; padding: 0.3rem 0.75rem; }
  }

  .badge--green {
    color: #22C55E;
    background: rgba(34, 197, 94, 0.12);
    border: 1px solid rgba(34, 197, 94, 0.2);
  }

  .badge--link {
    cursor: pointer;
    text-decoration: none;
    transition: background 0.2s, box-shadow 0.2s;
  }

  .badge--link:hover {
    background: rgba(34, 197, 94, 0.2);
    box-shadow: 0 0 12px rgba(34, 197, 94, 0.15);
  }

  .badge--yellow {
    color: #FBBF24;
    background: rgba(251, 191, 36, 0.1);
    border: 1px solid rgba(251, 191, 36, 0.15);
  }

  .badge--dim {
    color: var(--text-dim);
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid var(--border);
  }

  /* ---- No codes notice ---- */
  .no-codes-notice {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    background: rgba(251, 191, 36, 0.06);
    border: 1px solid rgba(251, 191, 36, 0.15);
    border-radius: 12px;
  }

  .no-codes-notice__icon {
    flex-shrink: 0;
    color: #FBBF24;
    margin-top: 2px;
  }

  .no-codes-notice__text {
    color: var(--text);
    font-size: 0.95rem;
    line-height: 1.6;
  }

  /* ---- Stats ---- */
  .stats {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .stat {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 0.5rem 0.75rem;
    flex: 1;
    min-width: 0;
  }

  .stat__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: rgba(99, 102, 241, 0.08);
    color: var(--accent, #6366F1);
    flex-shrink: 0;
  }

  .stat__value {
    font-family: var(--font-mono, var(--font-display));
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
  }

  .stat__label {
    font-size: 0.7rem;
    color: var(--text-dim);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  @media (max-width: 479px) {
    .stat {
      flex: 1 1 calc(50% - 0.25rem);
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 0.25rem;
      padding: 0.6rem 0.5rem;
    }
    .stat__icon {
      width: 28px;
      height: 28px;
    }
  }

  @media (min-width: 640px) {
    .stats { gap: 0.75rem; margin-bottom: 2rem; }
    .stat {
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 0.3rem;
      padding: 0.85rem 0.5rem;
      border-radius: 12px;
    }
    .stat__value { font-size: 1.25rem; }
    .stat__label { font-size: 0.75rem; }
  }

  /* ---- Secciones ---- */
  .section {
    margin-bottom: 1.75rem;
  }

  @media (min-width: 640px) {
    .section { margin-bottom: 2.5rem; }
  }

  .section__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 0.75rem;
  }

  @media (min-width: 640px) {
    .section__header { margin-bottom: 1rem; }
  }

  .section__title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-display);
    font-size: 1.15rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
  }

  .section__header .section__title {
    margin-bottom: 0;
  }

  @media (min-width: 640px) {
    .section__title { font-size: 1.25rem; margin-bottom: 1rem; }
    .section__header .section__title { margin-bottom: 0; }
  }

  .section__title--plain {
    padding-left: 0.85rem;
    border-left: 3px solid var(--accent, #6366F1);
  }

  .section__title--plain svg {
    display: none;
  }

  .section__title--dim {
    color: var(--text-dim);
  }

  .section__text {
    color: var(--text-dim);
    font-size: 0.95rem;
    line-height: 1.7;
  }

  .intro-text {
    color: var(--text);
    font-size: 0.9rem;
    line-height: 1.6;
  }

  @media (min-width: 640px) {
    .intro-text { font-size: 1rem; line-height: 1.7; }
  }

  .codes-list {
    display: flex;
    flex-direction: column;
    gap: 0.65rem;
  }

  .codes-check {
    font-size: 0.75rem;
    color: var(--text-dim);
    white-space: nowrap;
  }

  /* ---- Cómo canjear ---- */
  .redeem-box {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem 1.5rem;
  }

  .redeem-steps {
    list-style: none;
    counter-reset: step;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .redeem-steps__item {
    counter-increment: step;
    display: flex;
    align-items: baseline;
    gap: 0.75rem;
    font-size: 0.95rem;
    line-height: 1.5;
    color: var(--text-dim);
  }

  .redeem-steps__item::before {
    content: counter(step);
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 0.8rem;
    color: var(--accent, #6366F1);
    background: rgba(99, 102, 241, 0.1);
    min-width: 1.75rem;
    height: 1.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .roblox-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1.25rem;
    padding: 0.65rem 1.25rem;
    background: var(--accent, #6366F1);
    color: #fff;
    font-family: var(--font-display);
    font-size: 0.85rem;
    font-weight: 700;
    border-radius: 10px;
    text-decoration: none;
    transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
  }

  .roblox-link:hover {
    background: #818CF8;
    box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
    transform: translateY(-1px);
  }

  /* ---- Por qué no funcionan ---- */
  .reasons-box {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem 1.5rem;
  }

  .reasons-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding: 0;
    margin: 0;
  }

  .reasons-list li {
    font-size: 0.9rem;
    line-height: 1.6;
    color: var(--text-dim);
    padding-left: 1.25rem;
    position: relative;
  }

  .reasons-list li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.6rem;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--accent-hot, #F43F5E);
  }

  .reasons-list li strong {
    color: var(--text);
  }

  /* ---- Tabla info ---- */
  .info-table-wrap {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .info-table {
    width: 100%;
    border-collapse: collapse;
  }

  .info-table tr:not(:last-child) {
    border-bottom: 1px solid var(--border);
  }

  .info-table td {
    padding: 0.75rem 1rem;
    font-size: 0.9rem;
  }

  .info-table__label {
    color: var(--text-dim);
    width: 40%;
    font-weight: 600;
    font-size: 0.82rem;
  }

  .info-table__value {
    color: var(--text);
  }

  .info-table__link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    color: var(--accent, #6366F1);
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s;
  }

  .info-table__link:hover {
    color: #818CF8;
  }

  /* ---- Juegos relacionados ---- */
  .related-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  @media (min-width: 640px) {
    .related-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }
</style>
