---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';

const GENRES: Record<string, { label: string; color: string; desc: string }> = {
  pop:        { label: 'Pop',        color: '#ff6b9d', desc: 'Las mejores canciones Pop para tu Boombox en Roblox. √âxitos actuales y cl√°sicos del pop internacional.' },
  'hip-hop':  { label: 'Hip-Hop',    color: '#c084fc', desc: 'IDs de m√∫sica Hip-Hop y Rap para Roblox. Beats, freestyle y los √©xitos m√°s escuchados del g√©nero.' },
  dance:      { label: 'Dance',      color: '#22d3ee', desc: 'M√∫sica Dance y EDM para Roblox. Ritmos electr√≥nicos perfectos para tus sesiones de juego.' },
  rock:       { label: 'Rock',       color: '#ff6b6b', desc: 'Canciones de Rock para Roblox. Desde rock cl√°sico hasta alternativo, indie y metal.' },
  jazz:       { label: 'Jazz',       color: '#fbbf24', desc: 'M√∫sica Jazz para Roblox. Smooth jazz, bebop, jazz fusion y los cl√°sicos del g√©nero.' },
  electronic: { label: 'Electronic', color: '#06d6a0', desc: 'M√∫sica Electr√≥nica para Roblox. Synthwave, techno, house, trance y m√°s subg√©neros.' },
  country:    { label: 'Country',    color: '#f97316', desc: 'Canciones Country para Roblox. Country moderno, folk, americana y cl√°sicos del Nashville sound.' },
  classical:  { label: 'Classical',  color: '#a78bfa', desc: 'M√∫sica Cl√°sica para Roblox. Obras maestras de compositores como Bach, Mozart, Beethoven y m√°s.' },
};

export function getStaticPaths() {
  return ['pop','hip-hop','dance','rock','jazz','electronic','country','classical'].map(slug => ({ params: { genre: slug } }));
}

const { genre } = Astro.params;
const g = GENRES[genre!];
if (!g) return Astro.redirect('/herramientas/ids-musica-roblox/');

const GENRE_COLOR: Record<string,string> = Object.fromEntries(Object.entries(GENRES).map(([k,v])=>[k,v.color]));

const allSongs: Array<{title:string;artist:string;id:string;genre:string;thumbnail?:string;robloxUrl?:string;duration?:number;album?:string}> =
  (await import('../../../../data/music-ids.json', { with: { type: 'json' } })).default.songs;

const genreSongs = allSongs.filter(s => s.genre === genre);
const first100 = genreSongs.slice(0, 100);
const totalGenre = genreSongs.length.toLocaleString('es-ES');
const totalAll = allSongs.length.toLocaleString('es-ES');

const title = `IDs de M√∫sica ${g.label} para Roblox (2026) ‚Äî ${totalGenre} Canciones`;
const description = `${g.desc} ${totalGenre} IDs de m√∫sica ${g.label} actualizados para copiar y usar en Brookhaven, Royale High y m√°s.`;

function gc(genreVal: string) { return GENRE_COLOR[genreVal] || '#8892a4'; }
function fmtGenre(gv: string) { return gv ? gv.replace(/-/g,' ').replace(/\b\w/g,c=>c.toUpperCase()) : ''; }
function fmtDuration(sec: number) { const m = Math.floor(sec / 60); const s = sec % 60; return `${m}:${String(s).padStart(2, '0')}`; }

const faqSchema = {
  '@context': 'https://schema.org', '@type': 'FAQPage',
  mainEntity: [
    { '@type': 'Question', name: `¬øCu√°ntos IDs de m√∫sica ${g.label} hay para Roblox?`, acceptedAnswer: { '@type': 'Answer', text: `Tenemos ${totalGenre} IDs de m√∫sica ${g.label} verificados para Roblox, actualizados en 2026.` } },
    { '@type': 'Question', name: `¬øC√≥mo usar IDs de m√∫sica ${g.label} en Roblox?`, acceptedAnswer: { '@type': 'Answer', text: `Busca la canci√≥n ${g.label} que quieras, copia el ID con el bot√≥n Copiar, abre un juego compatible como Brookhaven o Royale High, busca el Boombox y pega el ID.` } },
  ],
};

const genreParam = genre;
---

<Layout title={title} description={description}>
  <script slot="head" type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
  <div class="music-page">
  <Header />

  <main class="main">
    <div class="page-wrap">

      <nav class="breadcrumbs">
        <a href="/">Inicio</a> <span class="sep">‚Ä∫</span>
        <a href="/herramientas/ids-musica-roblox/">IDs de M√∫sica</a> <span class="sep">‚Ä∫</span>
        <span>{g.label}</span>
      </nav>

      <div class="hero">
        <h1 class="hero__title" style={`--gc:${g.color}`}>
          IDs de M√∫sica <span class="hero__genre">{g.label}</span> para Roblox
          <br/><span class="hero__sub">{totalGenre} Canciones</span>
        </h1>
        <div class="search-box">
          <span class="search-box__icon">üîç</span>
          <input type="text" id="q" class="search-box__input" placeholder={`Buscar en ${g.label}...`} autocomplete="off" />
        </div>
        <p class="hero__stat"><span class="hero__num" style={`color:${g.color}`}>{totalGenre}</span> canciones {g.label}</p>
      </div>

      <!-- Other genres -->
      <div class="pills">
        <a href="/herramientas/ids-musica-roblox/" class="pill">Todos <span class="pill__count">({totalAll})</span></a>
        {Object.entries(GENRES).map(([slug, gdata]) => (
          <a href={`/herramientas/ids-musica-roblox/${slug}/`}
             class={`pill ${slug === genre ? 'pill--active' : ''}`}
             style={`--gc:${gdata.color}`}>
            {gdata.label}
          </a>
        ))}
      </div>

      <p class="info" id="info">{totalGenre} canciones {g.label}</p>

      <div class="grid" id="grid">
        {first100.map(s => (
          <div class="card" data-id={s.id}>
            <div class="card__thumb" style={s.thumbnail ? '' : 'background:#1a2236'}>
              {s.thumbnail
                ? <img src={s.thumbnail} alt={s.title} width="60" height="60" loading="lazy" />
                : <span class="card__note">üéµ</span>}
            </div>
            <div class="card__body">
              <span class="card__title">{s.title}</span>
              <span class="card__artist">{s.artist}</span>
              {s.album && <span class="card__album">{s.album}</span>}
              <div class="card__row">
                <span class="card__genre" style={`color:${gc(s.genre)};border-color:${gc(s.genre)}33`}>{fmtGenre(s.genre)}</span>
                {s.duration && <span class="card__dur">{fmtDuration(s.duration)}</span>}
                <code class="card__id">{s.id}</code>
              </div>
            </div>
            <div class="card__actions">
              <button class="cbtn" data-id={s.id}>Copiar</button>
              {s.robloxUrl && <a class="rlink" href={s.robloxUrl} target="_blank" rel="noopener">Abrir en Roblox ‚Üó</a>}
            </div>
          </div>
        ))}
      </div>

      <div class="more-wrap" id="more-wrap">
        <button class="more-btn" id="more-btn">Cargar m√°s canciones {g.label}</button>
      </div>

      <section class="seo">
        <h2 class="seo__h2">IDs de M√∫sica {g.label} para Roblox</h2>
        <p>{g.desc} Nuestra base de datos incluye <strong>{totalGenre} canciones {g.label}</strong> con IDs verificados que puedes copiar y pegar directamente en el Boombox de tu juego favorito.</p>
        <p>Usa el buscador para encontrar la canci√≥n que quieras por t√≠tulo o artista. Cada ID ha sido extra√≠do de la biblioteca oficial de audio de Roblox y est√° listo para usar en juegos como <strong>Brookhaven RP</strong>, <strong>Royale High</strong>, <strong>Boombox Island</strong> y muchos m√°s.</p>
      </section>

      <section class="seo">
        <h2 class="seo__h2">¬øC√≥mo usar estos IDs de m√∫sica {g.label}?</h2>
        <div class="steps-box">
          <ol class="steps">
            <li>Busca la canci√≥n {g.label} que quieras en la tabla de arriba</li>
            <li>Haz clic en <strong>Copiar</strong> para copiar el ID al portapapeles</li>
            <li>Abre un juego compatible (Brookhaven, Royale High, etc.)</li>
            <li>Busca el Boombox o radio y pega el ID</li>
            <li>Dale play y disfruta la m√∫sica</li>
          </ol>
        </div>
      </section>

    </div>
  </main>
  <Footer />
  </div>
</Layout>

<script define:vars={{ genreParam }}>
  window.__GENRE_FILTER = genreParam;
</script>

<script>
  const PAGE = 50;
  const GENRE_COLOR: Record<string,string> = {pop:'#ff6b9d','hip-hop':'#c084fc',dance:'#22d3ee',rock:'#ff6b6b',jazz:'#fbbf24',electronic:'#06d6a0',country:'#f97316',classical:'#a78bfa'};
  const GENRE_FILTER = (window as any).__GENRE_FILTER as string;

  type Song = {title:string;artist:string;id:string;genre:string;thumbnail?:string;robloxUrl?:string;duration?:number;album?:string};
  let all: Song[] = [];
  let filtered: Song[] = [];
  let shown = 0;
  let query = '';
  let loaded = false;
  let timer: ReturnType<typeof setTimeout>;

  const grid = document.getElementById('grid')!;
  const info = document.getElementById('info')!;
  const moreWrap = document.getElementById('more-wrap')!;
  const moreBtn = document.getElementById('more-btn')!;
  const input = document.getElementById('q') as HTMLInputElement;

  function gc(g:string){return GENRE_COLOR[g]||'#8892a4'}
  function fg(g:string){return g?g.replace(/-/g,' ').replace(/\b\w/g,c=>c.toUpperCase()):''}
  function esc(s:string){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
  function fmtDur(sec:number){const m=Math.floor(sec/60);const s=sec%60;return `${m}:${String(s).padStart(2,'0')}`}

  function cardHTML(s:Song){
    const thumb = s.thumbnail
      ? `<img src="${esc(s.thumbnail)}" alt="${esc(s.title)}" width="60" height="60" loading="lazy"/>`
      : `<span class="card__note">üéµ</span>`;
    const thumbStyle = s.thumbnail ? '' : 'background:#1a2236';
    const albumLine = s.album ? `<span class="card__album">${esc(s.album)}</span>` : '';
    const genreBadge = s.genre ? `<span class="card__genre" style="color:${gc(s.genre)};border-color:${gc(s.genre)}33">${fg(s.genre)}</span>` : '';
    const durBadge = s.duration ? `<span class="card__dur">${fmtDur(s.duration)}</span>` : '';
    const rlink = s.robloxUrl ? `<a class="rlink" href="${esc(s.robloxUrl)}" target="_blank" rel="noopener">Abrir en Roblox ‚Üó</a>` : '';
    return `<div class="card" data-id="${s.id}"><div class="card__thumb" style="${thumbStyle}">${thumb}</div><div class="card__body"><span class="card__title">${esc(s.title)}</span><span class="card__artist">${esc(s.artist)}</span>${albumLine}<div class="card__row">${genreBadge}${durBadge}<code class="card__id">${s.id}</code></div></div><div class="card__actions"><button class="cbtn" data-id="${s.id}">Copiar</button>${rlink}</div></div>`;
  }

  function render(){
    const batch = filtered.slice(shown, shown + PAGE);
    if(shown === 0) grid.innerHTML = batch.map(cardHTML).join('');
    else grid.insertAdjacentHTML('beforeend', batch.map(cardHTML).join(''));
    shown += batch.length;
    moreWrap.style.display = shown < filtered.length ? '' : 'none';
    const t = filtered.length.toLocaleString('es-ES');
    info.textContent = query ? `${t} resultados para "${query}"` : `${t} canciones ${fg(GENRE_FILTER)}`;
  }

  function apply(){
    const q = query.toLowerCase().trim();
    filtered = all.filter(s => {
      if(s.genre !== GENRE_FILTER) return false;
      if(q) return s.title.toLowerCase().includes(q) || s.artist.toLowerCase().includes(q);
      return true;
    });
    shown = 0;
    render();
  }

  input.addEventListener('input', ()=>{
    clearTimeout(timer);
    timer = setTimeout(()=>{
      query = input.value;
      if(!loaded) return;
      apply();
    }, 250);
  });

  moreBtn.addEventListener('click', ()=>{ if(loaded) render(); });

  grid.addEventListener('click', e=>{
    const btn = (e.target as HTMLElement).closest<HTMLButtonElement>('.cbtn');
    if(!btn) return;
    navigator.clipboard.writeText(btn.dataset.id!).then(()=>{
      btn.textContent = '‚úì Copiado';
      btn.classList.add('cbtn--ok');
      setTimeout(()=>{ btn.textContent = 'Copiar'; btn.classList.remove('cbtn--ok'); }, 2000);
    });
  });

  fetch('/data/music-ids.json')
    .then(r=>r.json())
    .then((d:{songs:Song[]})=>{
      all = d.songs;
      filtered = all.filter(s => s.genre === GENRE_FILTER);
      loaded = true;
      shown = 100;
      moreWrap.style.display = filtered.length > 100 ? '' : 'none';
    });
</script>

<style is:global>
  .music-page .main{padding:0 0 3rem}
  .music-page .page-wrap{width:100%;max-width:960px;margin:0 auto;padding:0 1rem}

  .music-page .breadcrumbs{font-size:.82rem;color:var(--text-dim);padding:1.25rem 0 0}
  .music-page .breadcrumbs a{color:var(--text-dim);text-decoration:none;transition:color .2s}
  .music-page .breadcrumbs a:hover{color:var(--accent)}
  .music-page .sep{margin:0 .35rem;opacity:.5}

  .music-page .hero{text-align:center;padding:2rem 0 1.25rem}
  .music-page .hero__title{font-family:var(--font-display);font-size:1.5rem;font-weight:700;line-height:1.25;margin-bottom:1.25rem}
  .music-page .hero__genre{color:var(--gc)}
  .music-page .hero__sub{font-size:1.15rem;color:var(--text-dim);font-weight:400}
  @media(min-width:640px){.music-page .hero__title{font-size:2rem}.music-page .hero__sub{font-size:1.3rem}}

  .music-page .search-box{position:relative;max-width:560px;margin:0 auto 1rem}
  .music-page .search-box__icon{position:absolute;left:1rem;top:50%;transform:translateY(-50%);font-size:1.1rem;pointer-events:none}
  .music-page .search-box__input{width:100%;padding:.9rem 1rem .9rem 2.8rem;background:var(--bg-card);border:2px solid var(--border);border-radius:12px;color:var(--text);font-family:var(--font-body);font-size:1rem;outline:none;transition:border-color .2s,box-shadow .2s}
  .music-page .search-box__input:focus{border-color:#06d6a0;box-shadow:0 0 0 4px rgba(6,214,160,.15),0 0 20px rgba(6,214,160,.1)}
  .music-page .search-box__input::placeholder{color:var(--text-dim);opacity:.6}

  .music-page .hero__stat{font-size:.85rem;color:var(--text-dim)}
  .music-page .hero__num{font-family:var(--font-display);font-weight:700}

  .music-page .pills{display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:.75rem;justify-content:center}
  .music-page .pill{font-family:var(--font-display);font-size:.72rem;font-weight:700;padding:.4rem .8rem;background:transparent;color:var(--text-dim);border:1.5px solid var(--border);border-radius:9999px;cursor:pointer;transition:all .2s;text-decoration:none}
  .music-page .pill:hover{border-color:var(--gc,var(--accent));color:var(--gc,var(--accent))}
  .music-page .pill--active{background:var(--gc,#06d6a0);border-color:var(--gc,#06d6a0);color:#0a0e1a}
  .music-page .pill__count{opacity:.65;font-weight:400}

  .music-page .info{font-size:.8rem;color:var(--text-dim);margin-bottom:.75rem;text-align:center}

  .music-page .grid{display:grid;grid-template-columns:1fr;gap:.65rem;margin-bottom:1.25rem}
  @media(min-width:640px){.music-page .grid{grid-template-columns:1fr 1fr}}

  .music-page .card{display:flex;align-items:flex-start;gap:.75rem;background:#111827;border:1px solid var(--border);border-radius:12px;padding:1rem;transition:transform .2s,box-shadow .2s,border-color .2s;cursor:default}
  .music-page .card:hover{transform:scale(1.02);box-shadow:0 4px 20px rgba(6,214,160,.12);border-color:rgba(6,214,160,.25)}

  .music-page .card__thumb{width:60px;height:60px;border-radius:8px;overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:#1a2236}
  .music-page .card__thumb img{width:100%;height:100%;object-fit:cover}
  .music-page .card__note{font-size:1.5rem}

  .music-page .card__body{flex:1;min-width:0}
  .music-page .card__title{display:block;font-weight:700;font-size:.88rem;line-height:1.25;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .music-page .card__artist{display:block;font-size:.78rem;color:var(--text-dim);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:.2rem}
  .music-page .card__album{display:block;font-size:.7rem;color:var(--text-dim);opacity:.65;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:.2rem}
  .music-page .card__row{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
  .music-page .card__dur{font-family:var(--font-display);font-size:.62rem;font-weight:700;color:var(--text-dim);padding:.12rem .4rem;background:rgba(255,255,255,.06);border-radius:6px;white-space:nowrap}
  .music-page .card__genre{font-family:var(--font-display);font-size:.62rem;font-weight:700;padding:.15rem .5rem;border:1px solid;border-radius:9999px;white-space:nowrap}
  .music-page .card__id{font-family:var(--font-display);font-size:.72rem;font-weight:700;color:#06d6a0}

  .music-page .card__actions{display:flex;flex-direction:column;align-items:flex-end;gap:.3rem;flex-shrink:0}
  .music-page .cbtn{font-family:var(--font-display);font-size:.68rem;font-weight:700;padding:.3rem .7rem;background:transparent;color:var(--accent);border:1.5px solid var(--accent);border-radius:8px;cursor:pointer;transition:all .2s;white-space:nowrap}
  .music-page .cbtn:hover,.music-page .cbtn--ok{background:#06d6a0;color:#0a0e1a;border-color:#06d6a0}
  .music-page .rlink{font-size:.62rem;color:var(--text-dim);text-decoration:none;transition:color .2s;white-space:nowrap}
  .music-page .rlink:hover{color:var(--accent)}

  .music-page .more-wrap{text-align:center;margin-bottom:2.5rem}
  .music-page .more-btn{font-family:var(--font-display);font-size:.88rem;font-weight:700;padding:.75rem 2.5rem;background:transparent;color:var(--accent);border:2px solid var(--accent);border-radius:10px;cursor:pointer;transition:all .2s}
  .music-page .more-btn:hover{background:#06d6a0;color:#0a0e1a}

  .music-page .seo{margin-bottom:2rem}
  .music-page .seo__h2{font-family:var(--font-display);font-size:1.1rem;font-weight:700;margin-bottom:.75rem;padding-left:.85rem;border-left:3px solid #06d6a0}
  .music-page .seo p{color:var(--text-dim);font-size:.92rem;line-height:1.7;margin-bottom:.75rem}
  .music-page .seo strong{color:var(--text)}

  .music-page .steps-box{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1rem 1.15rem;margin-bottom:.75rem}
  .music-page .steps{list-style:none;counter-reset:step;display:flex;flex-direction:column;gap:.55rem;padding:0;margin:0}
  .music-page .steps li{counter-increment:step;display:flex;align-items:baseline;gap:.6rem;font-size:.88rem;line-height:1.5;color:var(--text-dim)}
  .music-page .steps li::before{content:counter(step);font-family:var(--font-display);font-weight:700;font-size:.75rem;color:#06d6a0;background:rgba(6,214,160,.1);min-width:1.5rem;height:1.5rem;display:flex;align-items:center;justify-content:center;border-radius:50%;flex-shrink:0}
</style>
