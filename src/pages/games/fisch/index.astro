---
import GameLayout from '../../../layouts/GameLayout.astro';
import FischHero from '../../../components/FischHero.astro';

import fishData from '../../../data/games/fisch/fish.json';
import mutationsData from '../../../data/games/fisch/mutations.json';
import rodsData from '../../../data/games/fisch/rods.json';
import locationsData from '../../../data/games/fisch/locations.json';
import valuesData from '../../../data/games/fisch/values.json';

const totalFish = fishData.length;
const totalMutations = mutationsData.length;
const totalRods = rodsData.length;
const totalLocations = locationsData.length;

// Rarity breakdown
const rarities: Record<string, number> = {};
fishData.forEach((f: any) => {
  if (f.rarity) rarities[f.rarity] = (rarities[f.rarity] || 0) + 1;
});
const topRarities = Object.entries(rarities)
  .sort((a, b) => b[1] - a[1])
  .slice(0, 10);

const RARITY_COLORS: Record<string, string> = {
  'Trash': '#808080', 'Common': '#B0B0B0', 'Uncommon': '#2ECC71', 'Unusual': '#A3D977',
  'Rare': '#3498DB', 'Legendary': '#F39C12', 'Mythical': '#9B59B6', 'Exotic': '#E74C3C',
  'Secret': '#1ABC9C', 'Relic': '#CD7F32', 'Fragment': '#E056A0', 'Gemstone': '#00FFFF',
  'Extinct': '#5D6D7E', 'Limited': '#FFD700', 'Apex': '#FF4500', 'Special': '#FF69B4',
  'Divine Secret': '#FFE066',
};

// Last updated
const lastUpdated = new Date(valuesData.lastUpdated);
const lastUpdatedLabel = lastUpdated.toLocaleDateString('en-US', {
  month: 'long',
  day: 'numeric',
  year: 'numeric',
});

const fmt = (n: number) => n.toLocaleString('en-US');

const description = `The most complete Fisch database: ${fmt(totalFish)} fish, ${fmt(totalMutations)} mutations, ${fmt(totalRods)} rods, trade calculator, and value list. Updated daily.`;

// Icons (24x24 viewBox SVG inner content)
const ico: Record<string, string> = {
  fish: '<path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.46-3.44 6-7 6-3.56 0-7.56-2.54-8.5-6Z"/><path d="M3 12l3.5-3v6L3 12Z"/><circle cx="16" cy="10" r="1" fill="currentColor" stroke="none"/>',
  dna: '<path d="M2 15c6.667-6 13.333 0 20-6"/><path d="M9 22c1.798-1.998 2.518-3.995 2.807-5.993"/><path d="M15 2c-1.798 1.998-2.518 3.995-2.807 5.993"/><path d="m17 6-2.5 2.5"/><path d="M14 8.5 15.5 10"/><path d="m7 18 2.5-2.5"/><path d="M3.5 14.5 4 14"/>',
  rod: '<path d="M3 21l8-8"/><path d="M13 11l5-5"/><path d="M21 3l-3 1 1 3 3-1z"/><path d="M11 13l2-2"/>',
  map: '<path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>',
  coins: '<line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>',
  calc: '<rect width="16" height="20" x="4" y="2" rx="2"/><path d="M8 6h8"/><path d="M16 10h.01M12 10h.01M8 10h.01M16 14h.01M12 14h.01M8 14h.01M16 18h.01M12 18h.01M8 18h.01"/>',
  gift: '<rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5C10 3 12 8 12 8Z"/><path d="M16.5 8a2.5 2.5 0 0 0 0-5C14 3 12 8 12 8Z"/>',
  refresh: '<path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/>',
  arrow: '<path d="m9 18 6-6-6-6"/>',
};

// Quick link sections
const sections = [
  { title: 'Fish Database', desc: `${fmt(totalFish)} species catalogued — complete intelligence across all waters`, href: '/games/fisch/fish/', icon: 'fish', color: '#1DA2D8' },
  { title: 'Value List', desc: `Real-time market data for ${fmt(valuesData.items.length)} items — informed trading starts here`, href: '/games/fisch/values/', icon: 'coins', color: '#22D3EE' },
  { title: 'Trade Calculator', desc: 'Win/Fair/Lose analysis for every exchange — never get scammed again', href: '/games/fisch/calculator/', icon: 'calc', color: '#F97316' },
  { title: 'Mutations Guide', desc: `${fmt(totalMutations)} genetic modifiers documented — multiply your fortune`, href: '/games/fisch/mutations/', icon: 'dna', color: '#9B59B6' },
  { title: 'Fishing Rods', desc: `${fmt(totalRods)} rods compared — full stat breakdown for optimal loadout`, href: '/games/fisch/rods/', icon: 'rod', color: '#F39C12' },
  { title: 'Locations', desc: `${fmt(totalLocations)} fishing spots charted — every location catalogued`, href: '/games/fisch/locations/', icon: 'map', color: '#2ECC71' },
  { title: 'Active Codes', desc: 'Free rewards and active promotions — redeem before they expire', href: '/codigos-fisch/', icon: 'gift', color: '#E74C3C' },
];

// Stats for hero
const stats = [
  { label: 'Total Fish', value: fmt(totalFish), icon: 'fish', color: '#1DA2D8' },
  { label: 'Mutations', value: fmt(totalMutations), icon: 'dna', color: '#9B59B6' },
  { label: 'Rods', value: fmt(totalRods), icon: 'rod', color: '#F97316' },
  { label: 'Locations', value: fmt(totalLocations), icon: 'map', color: '#22D3EE' },
];

// FAQ
const faqs = [
  {
    q: 'What is Fisch?',
    a: `Fisch is a popular Roblox fishing game where players catch fish across multiple locations, collect mutations, upgrade rods, and trade with other players. With over ${fmt(totalFish)} species of fish, ${fmt(totalMutations)} mutations, and ${fmt(totalRods)} fishing rods, there\'s always something new to discover.`,
  },
  {
    q: 'How do you trade in Fisch?',
    a: 'To trade in Fisch, approach another player and use the trade menu. You can offer fish, items, and C$ (in-game currency). Always check the value list before trading to make sure you\'re getting a fair deal. Our trade calculator helps you determine if a trade is a Win, Fair, or Lose.',
  },
  {
    q: 'What are mutations in Fisch?',
    a: `Mutations are special modifiers that can appear on your caught fish, multiplying their value. There are ${fmt(totalMutations)} mutations in the game, ranging from common ones with small multipliers to ultra-rare ones like Ocean\'s Ruin (10.2x) and Tryhard (10x). Some mutations are exclusive to specific rods.`,
  },
  {
    q: 'How do I catch rare fish in Fisch?',
    a: 'Rare fish depend on several factors: your fishing location, rod stats (especially luck bonus), bait, weather conditions, time of day, and season. Check our Fish Database for specific requirements for each species. Higher-tier rods significantly increase your chances of catching rare fish.',
  },
];

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: faqs.map(f => ({
    '@type': 'Question',
    name: f.q,
    acceptedAnswer: { '@type': 'Answer', text: f.a },
  })),
};

const webSiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Fisch Guide - Codigos Gratis',
  url: new URL('/games/fisch/', Astro.site).href,
  description,
  publisher: { '@type': 'Organization', name: 'Codigos Gratis' },
};
---

<GameLayout
  title="Fisch - Complete Companion Guide | Roblox"
  description={description}
  game="Fisch"
  breadcrumbs={[]}
>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(webSiteSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
  </Fragment>

  <!-- HERO -->
  <FischHero title="FISCH" subtitle="COMMAND CENTER">
    <div class="hero__stats">
      {stats.map(s => (
        <div class="stat-card">
          <svg class="stat-card__ico" viewBox="0 0 24 24" fill="none" stroke={s.color} stroke-width="2" stroke-linecap="round" stroke-linejoin="round" set:html={ico[s.icon]} />
          <span class="stat-card__value">{s.value}</span>
          <span class="stat-card__label">{s.label}</span>
        </div>
      ))}
    </div>
  </FischHero>

  <!-- QUICK LINKS -->
  <section class="explore">
    <div class="container">
      <h2 class="sec-title">EXPLORE THE DATABASE</h2>
      <div class="explore__grid">
        {sections.map(s => (
          <a href={s.href} class="ecard" style={`--card-color: ${s.color}`}>
            <div class="ecard__icon-wrap">
              <svg class="ecard__ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" set:html={ico[s.icon]} />
            </div>
            <div class="ecard__body">
              <h3 class="ecard__title">{s.title}</h3>
              <p class="ecard__desc">{s.desc}</p>
            </div>
            <svg class="ecard__arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" set:html={ico.arrow} />
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- RARITY BREAKDOWN -->
  <section class="rarities">
    <div class="container">
      <h2 class="sec-title">Fish by Rarity</h2>
      <div class="rarities__grid">
        {topRarities.map(([rarity, count]) => {
          const c = RARITY_COLORS[rarity] || '#888';
          return (
            <div class="rchip" style={`--r: ${c}`}>
              <span class="rchip__dot" style={`background: ${c}`}></span>
              <span class="rchip__name">{rarity}</span>
              <span class="rchip__count">{count}</span>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <!-- LATEST UPDATES -->
  <section class="updates">
    <div class="container">
      <div class="updates__card">
        <div class="updates__ico-wrap">
          <svg class="updates__ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" set:html={ico.refresh} />
        </div>
        <div class="updates__body">
          <h2 class="updates__title">Latest Data Update</h2>
          <p class="updates__date">{lastUpdatedLabel}</p>
          <p class="updates__note">
            Our database is automatically updated with the latest fish, mutations, rods, and trading values
            from multiple sources including the Fisch Calculator and Fischipedia wiki.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section class="faq">
    <div class="container">
      <h2 class="sec-title">Frequently Asked Questions</h2>
      <div class="faq__list">
        {faqs.map(f => (
          <details class="faq__item">
            <summary class="faq__q">{f.q}</summary>
            <p class="faq__a">{f.a}</p>
          </details>
        ))}
      </div>
    </div>
  </section>
</GameLayout>

<style>
  /* ==========================================================================
     HERO
     ========================================================================== */

  /* Stat cards */
  .hero__stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    margin-top: 2rem;
    max-width: 560px;
    margin-inline: auto;
  }

  @media (min-width: 480px) {
    .hero__stats {
      grid-template-columns: repeat(4, 1fr);
      max-width: 680px;
    }
  }

  @media (min-width: 768px) {
    .hero {
      padding: 3.5rem 0 2.5rem;
    }
  }

  .stat-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 1.25rem 0.75rem;
    background: rgba(15, 23, 42, 0.75);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    transition: border-color 0.2s, transform 0.2s;
  }

  .stat-card:hover {
    border-color: rgba(29, 162, 216, 0.25);
    transform: translateY(-2px);
  }

  .stat-card__ico {
    width: 28px;
    height: 28px;
    margin-bottom: 4px;
  }

  .stat-card__value {
    font-family: var(--font-mono);
    font-size: 1.5rem;
    font-weight: 700;
    color: #fff;
    line-height: 1.2;
  }

  .stat-card__label {
    font-size: 0.7rem;
    color: var(--text-dim);
    font-weight: 500;
    letter-spacing: 0.3px;
  }

  /* ==========================================================================
     SECTION TITLE
     ========================================================================== */

  .sec-title {
    font-size: clamp(1.25rem, 3vw, 1.5rem);
    font-weight: 700;
    margin-bottom: 1.25rem;
    color: var(--text);
    letter-spacing: 0.08em;
  }

  /* ==========================================================================
     EXPLORE / QUICK LINKS
     ========================================================================== */

  .explore {
    padding: 1.5rem 0 0;
  }

  .explore__grid {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .ecard {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.25rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-left: 4px solid var(--card-color, var(--accent));
    border-radius: var(--radius);
    transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
  }

  .ecard:hover {
    border-color: var(--card-color, var(--accent));
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }

  .ecard__icon-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: var(--radius);
    background: color-mix(in srgb, var(--card-color) 12%, transparent);
    color: var(--card-color);
    flex-shrink: 0;
  }

  .ecard__ico {
    width: 22px;
    height: 22px;
  }

  .ecard__body {
    flex: 1;
    min-width: 0;
  }

  .ecard__title {
    font-size: 0.95rem;
    font-weight: 600;
    color: #fff;
    line-height: 1.3;
  }

  .ecard__desc {
    margin-top: 2px;
    font-size: 0.8rem;
    color: var(--text-dim);
    line-height: 1.45;
  }

  .ecard__arrow {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
    color: var(--text-dim);
    transition: color 0.2s, transform 0.2s;
  }

  .ecard:hover .ecard__arrow {
    color: var(--card-color, var(--accent));
    transform: translateX(3px);
  }

  @media (min-width: 640px) {
    .explore__grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }
  }

  @media (min-width: 960px) {
    .explore__grid {
      grid-template-columns: repeat(3, 1fr);
    }

    .ecard {
      flex-direction: column;
      align-items: flex-start;
      padding: 1.25rem;
      position: relative;
    }

    .ecard__arrow {
      position: absolute;
      right: 1rem;
      top: 1rem;
    }
  }

  /* ==========================================================================
     RARITY BREAKDOWN
     ========================================================================== */

  .rarities {
    padding: 2rem 0 0;
  }

  .rarities__grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .rchip {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.4rem 0.85rem;
    border-radius: var(--radius-pill);
    font-size: 0.85rem;
    font-weight: 600;
    border: 1px solid color-mix(in srgb, var(--r) 25%, transparent);
    background: color-mix(in srgb, var(--r) 8%, transparent);
    transition: transform 0.2s;
  }

  .rchip:hover {
    transform: scale(1.04);
  }

  .rchip__dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .rchip__name {
    color: var(--r);
  }

  .rchip__count {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--text-dim);
  }

  /* ==========================================================================
     LATEST UPDATES
     ========================================================================== */

  .updates {
    padding: 2rem 0 0;
  }

  .updates__card {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    padding: 1.25rem 1.5rem;
    background: rgba(15, 23, 42, 0.75);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(29, 162, 216, 0.15);
    border-radius: 12px;
  }

  .updates__ico-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: var(--radius);
    background: rgba(29, 162, 216, 0.12);
    color: var(--accent);
    flex-shrink: 0;
  }

  .updates__ico {
    width: 22px;
    height: 22px;
  }

  .updates__body {
    flex: 1;
  }

  .updates__title {
    font-size: 1rem;
    font-weight: 700;
    color: #fff;
  }

  .updates__date {
    margin-top: 0.25rem;
    font-size: 0.9rem;
    color: var(--accent);
    font-weight: 600;
    font-family: var(--font-mono);
  }

  .updates__note {
    margin-top: 0.4rem;
    font-size: 0.8rem;
    color: var(--text-dim);
    line-height: 1.55;
  }

  /* ==========================================================================
     FAQ
     ========================================================================== */

  .faq {
    padding: 2rem 0 0;
  }

  .faq__list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .faq__item {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    transition: border-color 0.2s;
  }

  .faq__item[open] {
    border-color: rgba(29, 162, 216, 0.25);
  }

  .faq__q {
    padding: 1rem 1.25rem;
    font-size: 0.95rem;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
    list-style: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    transition: color 0.2s;
  }

  .faq__q::-webkit-details-marker {
    display: none;
  }

  .faq__q::after {
    content: '+';
    font-size: 1.25rem;
    color: var(--text-dim);
    flex-shrink: 0;
    transition: transform 0.2s, color 0.2s;
    font-weight: 300;
  }

  .faq__item[open] .faq__q::after {
    content: '\2212';
    color: var(--accent);
  }

  .faq__q:hover {
    color: var(--accent);
  }

  .faq__a {
    padding: 0 1.25rem 1rem;
    font-size: 0.85rem;
    color: var(--text-dim);
    line-height: 1.65;
  }
</style>
