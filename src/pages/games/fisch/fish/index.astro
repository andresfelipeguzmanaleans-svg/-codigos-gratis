---
import GameLayout from '../../../../layouts/GameLayout.astro';
import FishTable from '../../../../components/FishTable.tsx';
import type { FishRow } from '../../../../components/FishTable.tsx';

import fishData from '../../../../data/games/fisch/fish.json';

// Build slim data for client
const fishRows: FishRow[] = (fishData as any[])
  .filter(f => f.id && f.name)
  .map(f => ({
    id: f.id,
    name: f.name,
    rarity: f.rarity,
    baseValue: f.baseValue,
    location: f.location,
    event: f.event,
    baseWeight: f.baseWeight,
    image: f.image,
  }));

const rarities = [...new Set(fishRows.map(f => f.rarity))].sort((a, b) => {
  const order: Record<string, number> = {
    'Apex': 0, 'Divine Secret': 1, 'Gemstone': 2, 'Relic': 3, 'Exotic': 4,
    'Secret': 5, 'Mythical': 6, 'Legendary': 7, 'Rare': 8, 'Unusual': 9,
    'Uncommon': 10, 'Common': 11, 'Special': 12, 'Limited': 13, 'Extinct': 14,
    'Fragment': 15, 'Trash': 16,
  };
  return (order[a] ?? 99) - (order[b] ?? 99);
});

const locations = [...new Set(fishRows.map(f => f.location).filter(Boolean) as string[])].sort();

const total = fishRows.length;
const fmt = (n: number) => n.toLocaleString('en-US');
---

<GameLayout
  title={`All ${fmt(total)} Fish Species - Complete Fisch Database`}
  description={`Browse every fish in Fisch Roblox. Filter by rarity, location, value. Complete database with ${fmt(total)} species.`}
  game="Fisch"
  breadcrumbs={[{ label: 'Fish Database', href: '/games/fisch/fish/' }]}
>
  <div class="container">
    <header class="page-hdr">
      <h1 class="page-hdr__title">Fish Database</h1>
      <p class="page-hdr__sub">{fmt(total)} species across {locations.length} locations and {rarities.length} rarity tiers</p>
    </header>

    <FishTable
      client:load
      fish={fishRows}
      rarities={rarities}
      locations={locations}
    />
  </div>
</GameLayout>

<style>
  .page-hdr {
    padding: 0.5rem 0 1.25rem;
  }

  .page-hdr__title {
    font-family: var(--font-display);
    font-size: 1.75rem;
    font-weight: 700;
    color: #fff;
  }

  .page-hdr__sub {
    margin-top: 0.25rem;
    font-size: 0.9rem;
    color: var(--text-dim);
  }

  @media (min-width: 768px) {
    .page-hdr__title {
      font-size: 2rem;
    }
  }

  /* ============================================================
     FISH TABLE â€” styles for the React component
     ============================================================ */

  /* Search */
  :global(.ft__filters) {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
    margin-bottom: 0.75rem;
  }

  :global(.ft__search-wrap) {
    position: relative;
    display: flex;
    align-items: center;
  }

  :global(.ft__search-ico) {
    position: absolute;
    left: 0.75rem;
    color: var(--text-dim);
    pointer-events: none;
  }

  :global(.ft__search) {
    width: 100%;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 0.6rem 0.75rem 0.6rem 2.25rem;
    color: var(--text);
    font-family: var(--font-body);
    font-size: 0.9rem;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  :global(.ft__search:focus) {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(6, 214, 160, 0.15);
  }

  :global(.ft__search::placeholder) {
    color: var(--text-dim);
  }

  /* Filter row */
  :global(.ft__filter-row) {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
  }

  :global(.ft__filter-btn),
  :global(.ft__select) {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.45rem 0.7rem;
    color: var(--text);
    font-family: var(--font-body);
    font-size: 0.8rem;
    cursor: pointer;
    outline: none;
    transition: border-color 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  :global(.ft__filter-btn:hover),
  :global(.ft__select:hover) {
    border-color: rgba(6, 214, 160, 0.3);
  }

  :global(.ft__filter-btn:focus),
  :global(.ft__select:focus) {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(6, 214, 160, 0.15);
  }

  :global(.ft__select option) {
    background: var(--bg-card);
    color: var(--text);
  }

  /* Rarity panel */
  :global(.ft__rarity-wrap) {
    position: relative;
  }

  :global(.ft__rarity-panel) {
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    z-index: 50;
    background: rgba(17, 24, 39, 0.97);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(6, 214, 160, 0.2);
    border-radius: 12px;
    padding: 0.5rem;
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.4);
    min-width: 200px;
    max-height: 360px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  :global(.ft__rarity-opt) {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.4rem 0.6rem;
    border-radius: 6px;
    font-size: 0.82rem;
    color: var(--text);
    cursor: pointer;
    transition: background 0.15s;
  }

  :global(.ft__rarity-opt:hover) {
    background: rgba(255, 255, 255, 0.05);
  }

  :global(.ft__rarity-opt input) {
    accent-color: var(--accent);
    width: 14px;
    height: 14px;
    cursor: pointer;
  }

  :global(.ft__rarity-dot) {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  :global(.ft__rarity-cnt) {
    margin-left: auto;
    font-size: 0.72rem;
    color: var(--text-dim);
    font-family: var(--font-display);
  }

  /* Event label */
  :global(.ft__event-label) {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.8rem;
    color: var(--text-dim);
    cursor: pointer;
    white-space: nowrap;
  }

  :global(.ft__event-label input) {
    accent-color: var(--accent);
    width: 14px;
    height: 14px;
    cursor: pointer;
  }

  /* Clear */
  :global(.ft__clear) {
    background: none;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.4rem 0.65rem;
    color: var(--accent-hot);
    font-size: 0.78rem;
    cursor: pointer;
    font-family: var(--font-body);
    transition: border-color 0.2s, background 0.2s;
  }

  :global(.ft__clear:hover) {
    border-color: var(--accent-hot);
    background: rgba(255, 107, 107, 0.08);
  }

  /* Count */
  :global(.ft__count) {
    font-size: 0.8rem;
    color: var(--text-dim);
    margin-bottom: 0.5rem;
    font-weight: 500;
  }

  /* Table */
  :global(.ft__table-wrap) {
    overflow-x: auto;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: var(--bg-card);
  }

  :global(.ft__table) {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }

  :global(.ft__th) {
    position: sticky;
    top: 0;
    background: var(--bg-card);
    padding: 0.65rem 0.75rem;
    text-align: left;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
    transition: color 0.2s;
  }

  :global(.ft__th:hover) {
    color: var(--accent);
  }

  :global(.ft__th--img) {
    width: 40px;
    cursor: default;
  }

  :global(.ft__th--loc) {
    cursor: default;
  }

  :global(.ft__row) {
    cursor: pointer;
    transition: background 0.15s;
  }

  :global(.ft__row:hover) {
    background: rgba(6, 214, 160, 0.04);
  }

  :global(.ft__row:not(:last-child) .ft__td) {
    border-bottom: 1px solid rgba(30, 41, 59, 0.5);
  }

  :global(.ft__td) {
    padding: 0.5rem 0.75rem;
    vertical-align: middle;
    white-space: nowrap;
  }

  :global(.ft__td--img) {
    width: 40px;
    padding: 0.35rem 0.5rem;
  }

  :global(.ft__thumb) {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    object-fit: contain;
    background: rgba(255, 255, 255, 0.03);
  }

  :global(.ft__thumb-ph) {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.03);
  }

  :global(.ft__td--name) {
    font-weight: 600;
  }

  :global(.ft__name-link) {
    color: #fff;
    transition: color 0.2s;
  }

  :global(.ft__name-link:hover) {
    color: var(--accent);
  }

  :global(.ft__badge) {
    display: inline-block;
    padding: 0.15rem 0.5rem;
    border: 1px solid;
    border-radius: 9999px;
    font-size: 0.72rem;
    font-weight: 600;
    letter-spacing: 0.3px;
  }

  :global(.ft__td--value) {
    font-family: var(--font-display);
    color: var(--text-dim);
    font-size: 0.82rem;
  }

  :global(.ft__td--loc) {
    color: var(--text-dim);
    font-size: 0.82rem;
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Hide location column on small screens */
  @media (max-width: 639px) {
    :global(.ft__th--loc),
    :global(.ft__td--loc) {
      display: none;
    }
  }

  /* Empty */
  :global(.ft__empty) {
    text-align: center;
    padding: 2rem 1rem;
    color: var(--text-dim);
    font-size: 0.9rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
  }

  /* Pagination */
  :global(.ft__pag) {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem 0 0.5rem;
  }

  :global(.ft__pag-btn) {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.4rem 0.65rem;
    color: var(--text);
    font-size: 0.85rem;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    font-family: var(--font-body);
  }

  :global(.ft__pag-btn:hover:not(:disabled)) {
    border-color: var(--accent);
    background: rgba(6, 214, 160, 0.06);
  }

  :global(.ft__pag-btn:disabled) {
    opacity: 0.3;
    cursor: default;
  }

  :global(.ft__pag-info) {
    font-size: 0.82rem;
    color: var(--text-dim);
    font-family: var(--font-display);
    min-width: 4rem;
    text-align: center;
  }
</style>
