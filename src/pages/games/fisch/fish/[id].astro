---
import GameLayout from '../../../../layouts/GameLayout.astro';
import FischHero from '../../../../components/FischHero.astro';
import FishValueCalc from '../../../../components/FishValueCalc.tsx';

import fishData from '../../../../data/games/fisch/fish.json';
import mutationsData from '../../../../data/games/fisch/mutations.json';
import valuesData from '../../../../data/games/fisch/values.json';

// ---------- Types ----------

interface Fish {
  id: string;
  name: string;
  rarity: string;
  sea: string | null;
  location: string | null;
  sublocation: string | null;
  sources: string[];
  xp: number | null;
  weather: string[];
  time: string | null;
  season: string[];
  bait: string[];
  baseWeight: number | null;
  baseValue: number | null;
  weightRange: { min: number; max: number } | null;
  baseChance: number | null;
  baseResil: number | null;
  event: string | null;
  description: string | null;
  descriptionIsGenerated: boolean;
  image: string | null;
  imageUrl: string | null;
  recommendedRod: { name: string; rodId: string; resilience: number } | null;
  difficulty: string;
  estimatedCsPerHour: number | null;
  recommendation: string;
  estimatedNpcValue: string | null;
  howToCatch: string | null;
}

interface Mutation {
  id: string;
  name: string;
  multiplier: number | { min: number; max: number };
}

interface ValueItem {
  itemId: string;
  name: string;
  basePrice: number;
  estimatedValue: { min: number; max: number } | null;
  baseCatchRate: number | null;
}

// ---------- Static paths ----------

export function getStaticPaths() {
  return (fishData as Fish[])
    .filter(f => f.id && f.name)
    .map(fish => ({
      params: { id: fish.id },
      props: { fish },
    }));
}

const { fish } = Astro.props as { fish: Fish };

// ---------- Derived data ----------

const tradingValue = (valuesData.items as ValueItem[]).find(
  v => v.itemId === fish.id,
);

const sameTier = (fishData as Fish[])
  .filter(f => f.rarity === fish.rarity && f.id !== fish.id && f.id && f.name);
// Deterministic shuffle by id hash
const shuffled = sameTier
  .map(f => ({ f, k: f.id.split('').reduce((a, c) => a + c.charCodeAt(0), 0) }))
  .sort((a, b) => a.k - b.k)
  .map(x => x.f);
const related = shuffled.slice(0, 10);

const fmt = (n: number) => n.toLocaleString('en-US');

const fmtC = (n: number): string => {
  if (n >= 1e12) return `${(n / 1e12).toFixed(2)}T`;
  if (n >= 1e9) return `${(n / 1e9).toFixed(2)}B`;
  if (n >= 1e6) return `${(n / 1e6).toFixed(2)}M`;
  if (n >= 1e3) return `${(n / 1e3).toFixed(1)}K`;
  return fmt(n);
};

// Meta
const valueStr = fish.baseValue ? `${fmt(fish.baseValue)} C$/kg` : 'unknown value';
const weightStr = fish.weightRange
  ? `${fmt(fish.weightRange.min)}-${fmt(fish.weightRange.max)} kg`
  : 'unknown weight';
const metaDesc = `Everything about ${fish.name} in Fisch Roblox: catch location, value (${valueStr}), weight (${weightStr}), mutations, and more.`;

// Rarity color map
const rarityColors: Record<string, { bg: string; border: string; text: string }> = {
  'Trash':          { bg: '#71717a20', border: '#71717a', text: '#a1a1aa' },
  'Common':         { bg: '#9ca3af20', border: '#9ca3af', text: '#d1d5db' },
  'Uncommon':       { bg: '#22c55e18', border: '#22c55e', text: '#4ade80' },
  'Unusual':        { bg: '#34d39e18', border: '#34d39e', text: '#6ee7b7' },
  'Rare':           { bg: '#3b82f618', border: '#3b82f6', text: '#60a5fa' },
  'Legendary':      { bg: '#f59e0b18', border: '#f59e0b', text: '#fbbf24' },
  'Mythical':       { bg: '#a855f718', border: '#a855f7', text: '#c084fc' },
  'Exotic':         { bg: '#ec489918', border: '#ec4899', text: '#f472b6' },
  'Limited':        { bg: '#ef444418', border: '#ef4444', text: '#f87171' },
  'Special':        { bg: '#06b6d418', border: '#06b6d4', text: '#22d3ee' },
  'Secret':         { bg: '#fbbf2418', border: '#fbbf24', text: '#fde68a' },
  'Divine Secret':  { bg: '#fde68a20', border: '#fde68a', text: '#fef3c7' },
  'Apex':           { bg: '#f43f5e18', border: '#f43f5e', text: '#fb7185' },
  'Extinct':        { bg: '#78716c18', border: '#a8a29e', text: '#d6d3d1' },
  'Relic':          { bg: '#c084fc18', border: '#c084fc', text: '#d8b4fe' },
  'Gemstone':       { bg: '#2dd4bf18', border: '#2dd4bf', text: '#5eead4' },
  'Fragment':       { bg: '#67e8f918', border: '#67e8f9', text: '#a5f3fc' },
};
const rc = rarityColors[fish.rarity] || { bg: '#ffffff10', border: '#ffffff40', text: '#e8eaf0' };

// Rarity ‚Üí visual theme
const rarityTheme: Record<string, string> = {
  'Trash': 'murk', 'Common': 'water', 'Uncommon': 'water', 'Unusual': 'nature', 'Rare': 'deep',
  'Legendary': 'flame', 'Limited': 'flame', 'Apex': 'inferno',
  'Mythical': 'mystic', 'Secret': 'mystic', 'Divine Secret': 'divine', 'Relic': 'mystic',
  'Exotic': 'cosmic', 'Fragment': 'cosmic', 'Gemstone': 'crystal', 'Special': 'electric',
  'Extinct': 'stone',
};
const theme = rarityTheme[fish.rarity] || 'water';

// Difficulty color map
const difficultyColors: Record<string, { bg: string; border: string; text: string }> = {
  'Easy':    { bg: '#22c55e20', border: '#22c55e', text: '#4ade80' },
  'Medium':  { bg: '#eab30820', border: '#eab308', text: '#facc15' },
  'Hard':    { bg: '#f9731620', border: '#f97316', text: '#fb923c' },
  'Extreme': { bg: '#ef444420', border: '#ef4444', text: '#f87171' },
};
const dc = difficultyColors[fish.difficulty] || { bg: '#ffffff10', border: '#ffffff40', text: '#e8eaf0' };

// Recommendation banner
const isKeep = fish.recommendation === 'KEEP FOR TRADING';

// Schema.org
const articleSchema = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: `${fish.name} - Fisch Guide`,
  description: metaDesc,
  author: { '@type': 'Organization', name: 'Codigos Gratis' },
  publisher: { '@type': 'Organization', name: 'Codigos Gratis' },
  mainEntityOfPage: new URL(Astro.url.pathname, Astro.site).href,
};

// Info grid items
const infoItems: { label: string; value: string; icon: string }[] = [];
if (fish.baseValue != null) infoItems.push({ label: 'Base Value', value: `${fmt(fish.baseValue)} C$/kg`, icon: 'üí∞' });
if (fish.weightRange) infoItems.push({ label: 'Weight Range', value: `${fmt(fish.weightRange.min)} ‚Äì ${fmt(fish.weightRange.max)} kg`, icon: '‚öñÔ∏è' });
if (fish.baseWeight != null) infoItems.push({ label: 'Base Weight', value: `${fmt(fish.baseWeight)} kg`, icon: 'üèãÔ∏è' });
if (fish.xp != null) infoItems.push({ label: 'XP', value: fmt(fish.xp), icon: '‚≠ê' });
if (fish.baseChance != null && fish.baseChance > 0) infoItems.push({ label: 'Catch Chance', value: `${fish.baseChance}%`, icon: 'üéØ' });
if (fish.baseResil != null) infoItems.push({ label: 'Resilience', value: fmt(fish.baseResil), icon: 'üõ°Ô∏è' });
if (fish.estimatedNpcValue) infoItems.push({ label: 'NPC Value (avg)', value: fish.estimatedNpcValue, icon: 'üè™' });
if (fish.estimatedCsPerHour != null) infoItems.push({ label: 'C$/Hour (est.)', value: `${fmtC(fish.estimatedCsPerHour)} C$`, icon: '‚è±Ô∏è' });

// Conditions
const conditions: { label: string; value: string; icon: string }[] = [];
if (fish.location) conditions.push({ label: 'Location', value: fish.sublocation ? `${fish.location} ‚Äî ${fish.sublocation}` : fish.location, icon: 'üìç' });
if (fish.bait.length > 0) conditions.push({ label: 'Bait', value: fish.bait.join(', '), icon: 'ü™±' });
if (fish.weather.length > 0) conditions.push({ label: 'Weather', value: fish.weather.join(', '), icon: 'üå§Ô∏è' });
if (fish.time) conditions.push({ label: 'Time', value: fish.time, icon: 'üïê' });
if (fish.season.length > 0) conditions.push({ label: 'Season', value: fish.season.join(', '), icon: 'üìÖ' });
if (fish.event) conditions.push({ label: 'Event', value: fish.event, icon: 'üéâ' });
if (fish.sources.length > 0) conditions.push({ label: 'Source', value: fish.sources.join(', '), icon: 'üé£' });
if (fish.recommendedRod) conditions.push({ label: 'Rec. Rod', value: fish.recommendedRod.name, icon: 'üé£' });

// Hero max value
const formattedMaxValue = tradingValue?.estimatedValue
  ? fmtC(tradingValue.estimatedValue.max)
  : null;

// Auto-generated narrative
const parts: string[] = [];
parts.push(fish.name + ' is a ' + fish.rarity.toLowerCase() + ' fish');
if (fish.location) parts.push(' found in ' + fish.location);
if (fish.sublocation) parts.push(' (' + fish.sublocation + ')');
parts.push('.');
if (fish.baseValue) parts.push(' With a base value of ' + fmt(fish.baseValue) + ' C$/kg');
if (fish.weightRange) parts.push(' and weight ranging from ' + fmt(fish.weightRange.min) + ' to ' + fmt(fish.weightRange.max) + ' kg');
if (fish.baseValue && fish.weightRange) parts.push(', this catch can be worth up to ' + fmtC(fish.baseValue * fish.weightRange.max) + ' C$ at max weight.');
else parts.push('.');
if (fish.bait && fish.bait.length > 0) parts.push(' Best caught using ' + fish.bait.join(' or ') + '.');
if (fish.weather && fish.weather.length > 0) parts.push(' Look for ' + fish.weather.join(' or ').toLowerCase() + ' weather.');
if (fish.event) parts.push(' This is a limited event fish from ' + fish.event + '.');
const narrative = parts.join('');

---

<GameLayout
  title={`${fish.name} - How to Catch, Value & Location | Fisch Guide`}
  description={metaDesc}
  game="Fisch"
  breadcrumbs={[
    { label: 'Fish', href: '/games/fisch/fish/' },
    { label: fish.name, href: `/games/fisch/fish/${fish.id}/` },
  ]}
>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
  </Fragment>

  <!-- HERO -->
  <FischHero
    title={fish.name.toUpperCase()}
    subtitle={fish.rarity}
    bgImage={fish.imageUrl || '/images/fisch-hero.webp'}
  >
    <span
      class="fish-detail__rarity-badge"
      style={`background:${rc.bg}; border-color:${rc.border}; color:${rc.text};`}
    >
      {fish.rarity}
    </span>
    <span
      class="fish-detail__diff-badge"
      style={`background:${dc.bg}; border-color:${dc.border}; color:${dc.text};`}
    >
      {fish.difficulty}
    </span>
    {formattedMaxValue && (
      <div class="fish-detail__giant-val">{formattedMaxValue} C$</div>
    )}
  </FischHero>

  <!-- MOBILE: How to Catch accordion (visible only on mobile, after hero) -->
  {fish.howToCatch && (
    <div class="container htc-cta-mobile-wrap">
      <details class="htc-accordion htc-accordion--mobile">
        <summary class="htc-accordion__toggle">
          <span class="htc-accordion__icon">üìñ</span>
          <span class="htc-accordion__text">How to Catch</span>
          <svg class="htc-accordion__chevron" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 8 10 12 14 8"/></svg>
        </summary>
        <div class="htc-accordion__body">
          {fish.howToCatch.split('\n\n').map(p => (
            <p class="htc-accordion__para">{p}</p>
          ))}
        </div>
      </details>
    </div>
  )}

  <!-- KEEP / SELL BANNER -->
  <div class="container">
    <div
      class:list={['fish-detail__rec-banner', { 'fish-detail__rec-banner--keep': isKeep }]}
    >
      <span class="fish-detail__rec-icon">{isKeep ? 'üíé' : 'üí∞'}</span>
      <span class="fish-detail__rec-text" style={`color:${isKeep ? '#fbbf24' : '#4ade80'};`}>
        {fish.recommendation}
      </span>
      <span class="fish-detail__rec-hint">
        {isKeep ? 'Trade with other players for best value' : 'Sell at NPC for quick C$'}
      </span>
    </div>
  </div>

  <!-- TWO-COLUMN LAYOUT -->
  <div class="container fish-detail__grid">
    <!-- LEFT: Main content -->
    <div class="fish-detail__main">
      <!-- FIELD DATA -->
      {infoItems.length > 0 && (
        <section class="info-section" aria-label="Fish stats" id="field-data">
          <h2 class="section-heading">FIELD DATA</h2>
          <div class="info-grid">
            {infoItems.map(item => (
              <div class="info-card">
                <span class="info-card__icon">{item.icon}</span>
                <span class="info-card__label">{item.label}</span>
                <span class="info-card__value">{item.value}</span>
              </div>
            ))}
          </div>
        </section>
      )}

      <!-- CONDITIONS -->
      {conditions.length > 0 && (
        <section class="conditions" id="catch-intel">
          <h2 class="section-heading">CATCH INTEL</h2>
          <div class="conditions__list">
            {conditions.map(c => (
              <div class="cond-row">
                <span class="cond-row__icon">{c.icon}</span>
                <span class="cond-row__label">{c.label}</span>
                {c.label === 'Location' ? (
                  <a href="/games/fisch/locations/" class="cond-row__value cond-row__link">
                    {c.value}
                  </a>
                ) : (
                  <span class="cond-row__value">{c.value}</span>
                )}
              </div>
            ))}
          </div>
        </section>
      )}

      <!-- VALUE CALCULATOR -->
      {fish.baseValue != null && fish.baseValue > 0 && fish.weightRange && (
        <section class="calc-section" id="value-assessment">
          <h2 class="section-heading">VALUE ASSESSMENT</h2>
          <FishValueCalc
            client:visible
            baseValue={fish.baseValue}
            weightMin={fish.weightRange.min}
            weightMax={fish.weightRange.max}
            baseWeight={fish.baseWeight || fish.weightRange.min}
            mutations={mutationsData as Mutation[]}
          />
        </section>
      )}

      <!-- TRADING VALUE -->
      {tradingValue && tradingValue.estimatedValue && (
        <section class="trading">
          <h2 class="section-heading">TRADING VALUE</h2>
          <div class="trading__card">
            <div class="trading__row">
              <span class="trading__label">Base Price</span>
              <span class="trading__val">{fmt(tradingValue.basePrice)} C$/kg</span>
            </div>
            <div class="trading__row">
              <span class="trading__label">Est. Value (min)</span>
              <span class="trading__val">{fmtC(tradingValue.estimatedValue.min)} C$</span>
            </div>
            <div class="trading__row">
              <span class="trading__label">Est. Value (max)</span>
              <span class="trading__val trading__val--highlight">{fmtC(tradingValue.estimatedValue.max)} C$</span>
            </div>
            {tradingValue.baseCatchRate != null && tradingValue.baseCatchRate > 0 && (
              <div class="trading__row">
                <span class="trading__label">Catch Rate</span>
                <span class="trading__val">{tradingValue.baseCatchRate}%</span>
              </div>
            )}
          </div>
        </section>
      )}

      <!-- DESCRIPTION (manual only) -->
      {fish.description && !fish.descriptionIsGenerated && (
        <section class="desc-section">
          <h2 class="section-heading">Description</h2>
          <p class="desc-section__text">{fish.description}</p>
        </section>
      )}

      <!-- OVERVIEW -->
      <section class="overview">
        <h2 class="section-heading" id="overview">OVERVIEW</h2>
        <p class="overview__text">{fish.descriptionIsGenerated ? fish.description : narrative}</p>
      </section>

      <!-- QUICK LINKS -->
      <section class="quick-links">
        <h2 class="section-heading">Explore More</h2>
        <div class="quick-links__grid">
          {fish.baseValue != null && fish.baseValue > 0 && (
            <a href="/games/fisch/calculator/" class="quick-link">
              <span class="quick-link__icon">üîÑ</span>
              <span class="quick-link__text">Calculate trade value</span>
            </a>
          )}
          <a href="/games/fisch/values/" class="quick-link">
            <span class="quick-link__icon">üí∞</span>
            <span class="quick-link__text">See current value list</span>
          </a>
          <a href="/games/fisch/mutations/" class="quick-link">
            <span class="quick-link__icon">üß¨</span>
            <span class="quick-link__text">Browse all mutations</span>
          </a>
          {fish.location && (
            <a href={`/games/fisch/locations/`} class="quick-link">
              <span class="quick-link__icon">üìç</span>
              <span class="quick-link__text">All fishing locations</span>
            </a>
          )}
        </div>
      </section>

      <!-- RELATED FISH -->
      {related.length > 0 && (
        <section class="related" id="related">
          <h2 class="section-heading">Other {fish.rarity} Fish</h2>
          <div class="related__grid">
            {related.map(r => (
              <a href={`/games/fisch/fish/${r.id}/`} class="related__card">
                <div class="related__img-wrap">
                  {r.imageUrl ? (
                    <img src={r.imageUrl} alt={r.name} class="related__img" loading="lazy" />
                  ) : (
                    <div class="related__img-placeholder">
                      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity: 0.3; color: var(--text-dim);">
                        <path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.46-3.44 6-7 6-3.56 0-7.56-2.54-8.5-6Z"/>
                        <path d="M3 12l3.5-3v6L3 12Z"/>
                        <circle cx="16" cy="10" r="1" fill="currentColor" stroke="none"/>
                      </svg>
                    </div>
                  )}
                </div>
                <span class="related__name">{r.name}</span>
                {r.baseValue != null && (
                  <span class="related__value">{fmt(r.baseValue)} C$/kg</span>
                )}
              </a>
            ))}
          </div>
          <a href="/games/fisch/fish/" class="related__see-all">See all {fish.rarity} fish &rarr;</a>
        </section>
      )}
    </div>

    <!-- RIGHT: Info sidebar -->
    <aside class="fish-detail__aside">
      <!-- Fish image -->
      <div class="fish-detail__img-card" data-theme={theme} style={`--r-clr: ${rc.border}`}>
        {fish.imageUrl ? (
          <img src={fish.imageUrl} alt={fish.name} class="fish-detail__img-large" />
        ) : (
          <div class="fish-detail__img-placeholder" style={`background: ${rc.bg}`}>
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style={`opacity: 0.3; color: ${rc.border}`}>
              <path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.46-3.44 6-7 6-3.56 0-7.56-2.54-8.5-6Z"/>
              <path d="M3 12l3.5-3v6L3 12Z"/>
              <circle cx="16" cy="10" r="1" fill="currentColor" stroke="none"/>
            </svg>
          </div>
        )}
      </div>

      <!-- How to Catch accordion (desktop sidebar) -->
      {fish.howToCatch && (
        <details class="htc-accordion htc-accordion--sidebar">
          <summary class="htc-accordion__toggle">
            <span class="htc-accordion__icon">üìñ</span>
            <span class="htc-accordion__text">How to Catch</span>
            <svg class="htc-accordion__chevron" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 8 10 12 14 8"/></svg>
          </summary>
          <div class="htc-accordion__body">
            {fish.howToCatch.split('\n\n').map(p => (
              <p class="htc-accordion__para">{p}</p>
            ))}
          </div>
        </details>
      )}

      <!-- Quick data table -->
      <div class="fish-detail__qd">
        <div class="fish-detail__qd-row">
          <span class="fish-detail__qd-label">Rarity</span>
          <span class="fish-detail__qd-value" style={`color: ${rc.text}`}>{fish.rarity}</span>
        </div>
        {fish.location && (
          <div class="fish-detail__qd-row">
            <span class="fish-detail__qd-label">Location</span>
            <span class="fish-detail__qd-value">{fish.sublocation ? `${fish.location} ‚Äî ${fish.sublocation}` : fish.location}</span>
          </div>
        )}
        {fish.bait.length > 0 && (
          <div class="fish-detail__qd-row">
            <span class="fish-detail__qd-label">Bait</span>
            <span class="fish-detail__qd-value">{fish.bait.join(', ')}</span>
          </div>
        )}
        {fish.baseValue != null && (
          <div class="fish-detail__qd-row">
            <span class="fish-detail__qd-label">Base Value</span>
            <span class="fish-detail__qd-value">{fmt(fish.baseValue)} C$/kg</span>
          </div>
        )}
        {fish.weightRange && (
          <div class="fish-detail__qd-row">
            <span class="fish-detail__qd-label">Weight Range</span>
            <span class="fish-detail__qd-value">{fmt(fish.weightRange.min)} ‚Äì {fmt(fish.weightRange.max)} kg</span>
          </div>
        )}
        {fish.xp != null && (
          <div class="fish-detail__qd-row">
            <span class="fish-detail__qd-label">XP</span>
            <span class="fish-detail__qd-value">{fmt(fish.xp)}</span>
          </div>
        )}
      </div>

      <!-- Table of contents -->
      <nav class="fish-detail__toc">
        <span class="fish-detail__toc-title">ON THIS PAGE</span>
        <a href="#field-data" class="fish-detail__toc-link">Field Data</a>
        <a href="#catch-intel" class="fish-detail__toc-link">Catch Intel</a>
        <a href="#value-assessment" class="fish-detail__toc-link">Value Assessment</a>
        <a href="#overview" class="fish-detail__toc-link">Overview</a>
        <a href="#related" class="fish-detail__toc-link">Related Catches</a>
      </nav>
    </aside>
  </div>
</GameLayout>

<style>
  /* ============================================================
     HERO SLOT ELEMENTS
     ============================================================ */

  .fish-detail__rarity-badge {
    display: inline-block;
    margin-top: 0.25rem;
    padding: 0.2rem 0.75rem;
    border: 1px solid;
    border-radius: 9999px;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .fish-detail__diff-badge {
    display: inline-block;
    margin-top: 0.25rem;
    margin-left: 0.4rem;
    padding: 0.2rem 0.75rem;
    border: 1px solid;
    border-radius: 9999px;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .fish-detail__giant-val {
    font-family: var(--font-mono);
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 700;
    color: var(--accent-secondary, #22D3EE);
    margin-top: 0.5rem;
    text-shadow: 0 0 40px rgba(34, 211, 238, 0.4);
  }

  /* ============================================================
     RECOMMENDATION BANNER
     ============================================================ */

  .fish-detail__rec-banner {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1.25rem;
    border: 1px solid rgba(34, 197, 94, 0.3);
    border-radius: 12px;
    margin-bottom: 1.5rem;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.12), rgba(22, 163, 74, 0.08));
  }

  .fish-detail__rec-banner--keep {
    border-color: rgba(245, 158, 11, 0.3);
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.12), rgba(217, 119, 6, 0.08));
  }

  .fish-detail__rec-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .fish-detail__rec-text {
    font-family: var(--font-display);
    font-size: 0.95rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .fish-detail__rec-hint {
    font-size: 0.8rem;
    color: var(--text-dim);
    margin-left: auto;
  }

  @media (max-width: 479px) {
    .fish-detail__rec-hint {
      display: none;
    }
  }

  /* ============================================================
     TWO-COLUMN GRID LAYOUT
     ============================================================ */

  .fish-detail__grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .fish-detail__grid {
      display: grid;
      grid-template-columns: 1fr 280px;
      gap: 1.5rem;
      align-items: start;
    }
  }

  .fish-detail__main {
    min-width: 0;
  }

  .fish-detail__aside {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  @media (max-width: 767px) {
    .fish-detail__aside {
      order: -1;
    }

    .fish-detail__img-card {
      padding: 1rem;
      background: rgba(15, 29, 53, 0.8);
      border-color: rgba(29, 162, 216, 0.15);
    }

    .fish-detail__img-large {
      max-height: 160px;
    }

    .fish-detail__toc {
      display: none;
    }
  }

  @media (min-width: 768px) {
    .fish-detail__aside {
      position: sticky;
      top: calc(var(--topbar-h, 56px) + 1rem);
    }
  }

  /* ============================================================
     SIDEBAR: FISH IMAGE ‚Äî rarity-themed environment
     ============================================================ */

  .fish-detail__img-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    min-height: 200px;
  }

  /* ---------- Ambient glow (rarity-colored) ---------- */
  .fish-detail__img-card::before {
    content: '';
    position: absolute;
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: radial-gradient(circle, color-mix(in srgb, var(--r-clr) 22%, transparent) 0%, transparent 70%);
    animation: fish-glow 4s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }

  /* ---------- Texture overlay (::after) ---------- */
  .fish-detail__img-card::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0;
    border-radius: 12px;
  }

  /* ---------- Fish image ---------- */
  .fish-detail__img-large {
    max-width: 100%;
    max-height: 200px;
    object-fit: contain;
    position: relative;
    z-index: 1;
    animation:
      fish-float 3s ease-in-out infinite,
      fish-swim  6s ease-in-out infinite;
    filter: drop-shadow(0 4px 16px color-mix(in srgb, var(--r-clr) 25%, transparent));
    transition: filter 0.3s;
  }

  .fish-detail__img-card:hover .fish-detail__img-large {
    animation-play-state: paused;
    filter: drop-shadow(0 0 28px color-mix(in srgb, var(--r-clr) 55%, transparent));
  }

  @keyframes fish-float {
    0%, 100% { transform: translateY(0); }
    50%      { transform: translateY(-8px); }
  }

  @keyframes fish-swim {
    0%, 100% { transform: translateX(0) rotate(0deg)   scaleX(1); }
    25%      { transform: translateX(4px) rotate(2deg)  scaleX(1.01); }
    50%      { transform: translateX(0) rotate(0deg)    scaleX(1); }
    75%      { transform: translateX(-4px) rotate(-2deg) scaleX(1.01); }
  }

  @keyframes fish-glow {
    0%, 100% { opacity: 0.4; transform: scale(1); }
    50%      { opacity: 0.85; transform: scale(1.35); }
  }

  /* ==========================================================
     WATER ‚Äî Common, Uncommon (calm blue/green ripples)
     ========================================================== */
  [data-theme="water"] {
    background:
      radial-gradient(ellipse at 25% 40%, color-mix(in srgb, var(--r-clr) 14%, transparent), transparent 65%),
      radial-gradient(ellipse at 75% 75%, color-mix(in srgb, var(--r-clr) 10%, transparent), transparent 55%),
      var(--bg-card);
  }
  [data-theme="water"]::after {
    background:
      repeating-linear-gradient(175deg, transparent 0px, transparent 28px, color-mix(in srgb, var(--r-clr) 5%, transparent) 29px, transparent 31px);
    animation: env-drift 10s linear infinite;
  }

  /* ==========================================================
     MURK ‚Äî Trash (dark murky water, slight greenish)
     ========================================================== */
  [data-theme="murk"] {
    background:
      radial-gradient(ellipse at 50% 100%, rgba(113, 113, 122, 0.15), transparent 70%),
      linear-gradient(180deg, var(--bg-card), color-mix(in srgb, var(--r-clr) 8%, var(--bg-card))),
      var(--bg-card);
  }
  [data-theme="murk"]::after {
    background:
      repeating-linear-gradient(185deg, transparent 0px, transparent 20px, rgba(113,113,122,0.04) 21px, transparent 23px),
      repeating-linear-gradient(170deg, transparent 0px, transparent 35px, rgba(113,113,122,0.03) 36px, transparent 38px);
    animation: env-drift 14s linear infinite;
  }

  /* ==========================================================
     DEEP ‚Äî Rare (deep ocean, slow dark waves)
     ========================================================== */
  [data-theme="deep"] {
    background:
      radial-gradient(ellipse at 30% 30%, color-mix(in srgb, var(--r-clr) 18%, transparent), transparent 60%),
      radial-gradient(ellipse at 80% 70%, rgba(59, 130, 246, 0.08), transparent 50%),
      linear-gradient(180deg, var(--bg-card), color-mix(in srgb, var(--r-clr) 6%, var(--bg-card))),
      var(--bg-card);
  }
  [data-theme="deep"]::after {
    background:
      repeating-linear-gradient(172deg, transparent 0px, transparent 22px, color-mix(in srgb, var(--r-clr) 6%, transparent) 23px, transparent 25px),
      repeating-linear-gradient(188deg, transparent 0px, transparent 35px, color-mix(in srgb, var(--r-clr) 4%, transparent) 36px, transparent 38px);
    animation: env-drift 12s linear infinite;
  }

  /* ==========================================================
     NATURE ‚Äî Unusual (organic green, leaf-like movement)
     ========================================================== */
  [data-theme="nature"] {
    background:
      radial-gradient(ellipse at 20% 80%, color-mix(in srgb, var(--r-clr) 16%, transparent), transparent 60%),
      radial-gradient(ellipse at 80% 20%, color-mix(in srgb, var(--r-clr) 10%, transparent), transparent 50%),
      linear-gradient(160deg, var(--bg-card), color-mix(in srgb, var(--r-clr) 5%, var(--bg-card))),
      var(--bg-card);
  }
  [data-theme="nature"]::after {
    background:
      radial-gradient(circle 40px at 15% 85%, color-mix(in srgb, var(--r-clr) 8%, transparent), transparent),
      radial-gradient(circle 30px at 85% 15%, color-mix(in srgb, var(--r-clr) 6%, transparent), transparent),
      radial-gradient(circle 25px at 50% 50%, color-mix(in srgb, var(--r-clr) 5%, transparent), transparent);
    animation: env-breathe 6s ease-in-out infinite;
  }

  /* ==========================================================
     FLAME ‚Äî Legendary, Limited (golden fire rising)
     ========================================================== */
  [data-theme="flame"] {
    background:
      linear-gradient(0deg, color-mix(in srgb, var(--r-clr) 18%, transparent), transparent 55%),
      radial-gradient(ellipse at 50% 90%, color-mix(in srgb, var(--r-clr) 14%, transparent), transparent 65%),
      var(--bg-card);
  }
  [data-theme="flame"]::after {
    background:
      radial-gradient(circle 3px at 20% 75%, var(--r-clr), transparent 4px),
      radial-gradient(circle 2px at 40% 85%, var(--r-clr), transparent 3px),
      radial-gradient(circle 2.5px at 60% 70%, var(--r-clr), transparent 4px),
      radial-gradient(circle 1.5px at 75% 80%, var(--r-clr), transparent 3px),
      radial-gradient(circle 2px at 35% 65%, var(--r-clr), transparent 3px),
      radial-gradient(circle 3px at 55% 90%, var(--r-clr), transparent 4px),
      radial-gradient(circle 1.5px at 85% 72%, var(--r-clr), transparent 3px);
    opacity: 0.3;
    animation: env-rise 3.5s ease-in-out infinite;
  }

  /* ==========================================================
     INFERNO ‚Äî Apex (intense red/orange, violent embers)
     ========================================================== */
  [data-theme="inferno"] {
    background:
      linear-gradient(0deg, color-mix(in srgb, var(--r-clr) 24%, transparent), transparent 50%),
      radial-gradient(ellipse at 50% 85%, color-mix(in srgb, var(--r-clr) 18%, transparent), transparent 60%),
      radial-gradient(ellipse at 30% 60%, rgba(249, 115, 22, 0.08), transparent 50%),
      var(--bg-card);
    border-color: color-mix(in srgb, var(--r-clr) 25%, var(--border));
  }
  [data-theme="inferno"]::after {
    background:
      radial-gradient(circle 3px at 15% 70%, var(--r-clr), transparent 5px),
      radial-gradient(circle 2.5px at 30% 85%, var(--r-clr), transparent 4px),
      radial-gradient(circle 4px at 50% 65%, var(--r-clr), transparent 6px),
      radial-gradient(circle 2px at 65% 80%, var(--r-clr), transparent 4px),
      radial-gradient(circle 3px at 80% 70%, var(--r-clr), transparent 5px),
      radial-gradient(circle 2px at 45% 92%, var(--r-clr), transparent 3px),
      radial-gradient(circle 3.5px at 25% 60%, rgba(249, 115, 22, 0.9), transparent 5px),
      radial-gradient(circle 2px at 70% 55%, rgba(249, 115, 22, 0.7), transparent 4px);
    opacity: 0.35;
    animation: env-rise 2.5s ease-in-out infinite;
  }

  /* ==========================================================
     MYSTIC ‚Äî Mythical, Secret, Relic (swirling vortex)
     ========================================================== */
  [data-theme="mystic"] {
    background:
      radial-gradient(circle at 50% 50%, color-mix(in srgb, var(--r-clr) 12%, transparent), transparent 65%),
      conic-gradient(from 0deg at 50% 50%, transparent, color-mix(in srgb, var(--r-clr) 6%, transparent) 25%, transparent 50%),
      var(--bg-card);
  }
  [data-theme="mystic"]::after {
    inset: -30%;
    background: conic-gradient(
      from 0deg at 50% 50%,
      transparent 0deg,
      color-mix(in srgb, var(--r-clr) 7%, transparent) 60deg,
      transparent 120deg,
      color-mix(in srgb, var(--r-clr) 5%, transparent) 200deg,
      transparent 260deg,
      color-mix(in srgb, var(--r-clr) 6%, transparent) 320deg,
      transparent 360deg
    );
    animation: env-swirl 25s linear infinite;
    border-radius: 0;
  }

  /* ==========================================================
     DIVINE ‚Äî Divine Secret (radiant golden light rays)
     ========================================================== */
  [data-theme="divine"] {
    background:
      radial-gradient(circle at 50% 30%, color-mix(in srgb, var(--r-clr) 20%, transparent), transparent 60%),
      linear-gradient(180deg, color-mix(in srgb, var(--r-clr) 8%, transparent), transparent 70%),
      var(--bg-card);
    border-color: color-mix(in srgb, var(--r-clr) 30%, var(--border));
  }
  [data-theme="divine"]::after {
    inset: -50%;
    background: conic-gradient(
      from 0deg at 50% 50%,
      transparent 0deg,
      color-mix(in srgb, var(--r-clr) 10%, transparent) 15deg,
      transparent 30deg,
      color-mix(in srgb, var(--r-clr) 8%, transparent) 55deg,
      transparent 70deg,
      color-mix(in srgb, var(--r-clr) 10%, transparent) 100deg,
      transparent 115deg,
      color-mix(in srgb, var(--r-clr) 7%, transparent) 145deg,
      transparent 160deg,
      color-mix(in srgb, var(--r-clr) 9%, transparent) 195deg,
      transparent 210deg,
      color-mix(in srgb, var(--r-clr) 10%, transparent) 245deg,
      transparent 260deg,
      color-mix(in srgb, var(--r-clr) 8%, transparent) 300deg,
      transparent 315deg,
      color-mix(in srgb, var(--r-clr) 9%, transparent) 345deg,
      transparent 360deg
    );
    animation: env-swirl 40s linear infinite;
    border-radius: 0;
  }

  /* ==========================================================
     COSMIC ‚Äî Exotic, Fragment (twinkling starfield)
     ========================================================== */
  [data-theme="cosmic"] {
    background:
      radial-gradient(circle at 50% 50%, color-mix(in srgb, var(--r-clr) 10%, transparent), transparent 60%),
      radial-gradient(circle at 20% 30%, color-mix(in srgb, var(--r-clr) 6%, transparent), transparent 40%),
      radial-gradient(circle at 80% 70%, color-mix(in srgb, var(--r-clr) 6%, transparent), transparent 40%),
      var(--bg-card);
  }
  [data-theme="cosmic"]::after {
    background:
      radial-gradient(circle 1.5px at 12% 20%, var(--r-clr), transparent 2px),
      radial-gradient(circle 1px   at 88% 15%, var(--r-clr), transparent 2px),
      radial-gradient(circle 2px   at 45% 82%, var(--r-clr), transparent 3px),
      radial-gradient(circle 1px   at 72% 50%, var(--r-clr), transparent 2px),
      radial-gradient(circle 1.5px at 22% 68%, var(--r-clr), transparent 2px),
      radial-gradient(circle 1px   at 92% 78%, var(--r-clr), transparent 2px),
      radial-gradient(circle 2px   at 55% 30%, var(--r-clr), transparent 3px),
      radial-gradient(circle 1px   at 35% 45%, var(--r-clr), transparent 2px),
      radial-gradient(circle 1.5px at 68% 88%, var(--r-clr), transparent 2px);
    animation: env-twinkle 3s ease-in-out infinite alternate;
  }

  /* ==========================================================
     CRYSTAL ‚Äî Gemstone (prismatic shimmer)
     ========================================================== */
  [data-theme="crystal"] {
    background:
      linear-gradient(135deg,
        color-mix(in srgb, var(--r-clr) 10%, transparent),
        transparent 30%,
        rgba(168, 85, 247, 0.06) 50%,
        transparent 70%,
        color-mix(in srgb, var(--r-clr) 8%, transparent)
      ),
      radial-gradient(circle at 50% 50%, color-mix(in srgb, var(--r-clr) 12%, transparent), transparent 60%),
      var(--bg-card);
    border-color: color-mix(in srgb, var(--r-clr) 20%, var(--border));
  }
  [data-theme="crystal"]::after {
    background:
      linear-gradient(135deg, transparent 40%, color-mix(in srgb, var(--r-clr) 12%, transparent) 50%, transparent 60%);
    background-size: 200% 200%;
    animation: env-shimmer 4s ease-in-out infinite;
  }

  /* ==========================================================
     ELECTRIC ‚Äî Special (pulsing electric arcs)
     ========================================================== */
  [data-theme="electric"] {
    background:
      radial-gradient(circle at 50% 50%, color-mix(in srgb, var(--r-clr) 15%, transparent), transparent 55%),
      var(--bg-card);
    border-color: color-mix(in srgb, var(--r-clr) 18%, var(--border));
  }
  [data-theme="electric"]::after {
    background:
      linear-gradient(90deg, transparent 48%, color-mix(in srgb, var(--r-clr) 15%, transparent) 50%, transparent 52%),
      linear-gradient(0deg, transparent 48%, color-mix(in srgb, var(--r-clr) 10%, transparent) 50%, transparent 52%),
      radial-gradient(circle 2px at 30% 30%, var(--r-clr), transparent 3px),
      radial-gradient(circle 2px at 70% 70%, var(--r-clr), transparent 3px);
    animation: env-pulse 2s ease-in-out infinite;
  }

  /* ==========================================================
     STONE ‚Äî Extinct (cracked rock, static + faint shimmer)
     ========================================================== */
  [data-theme="stone"] {
    background:
      linear-gradient(137deg, transparent 38%, color-mix(in srgb, var(--r-clr) 6%, transparent) 39%, transparent 40%),
      linear-gradient(52deg, transparent 53%, color-mix(in srgb, var(--r-clr) 5%, transparent) 54%, transparent 55%),
      linear-gradient(195deg, transparent 28%, color-mix(in srgb, var(--r-clr) 4%, transparent) 29%, transparent 30%),
      linear-gradient(310deg, transparent 63%, color-mix(in srgb, var(--r-clr) 4%, transparent) 64%, transparent 65%),
      radial-gradient(circle at 50% 50%, color-mix(in srgb, var(--r-clr) 6%, transparent), transparent 70%),
      var(--bg-card);
  }
  [data-theme="stone"]::after {
    background: radial-gradient(ellipse at 50% 50%, color-mix(in srgb, var(--r-clr) 5%, transparent), transparent 70%);
    animation: env-breathe 8s ease-in-out infinite;
  }

  /* ==========================================================
     THEME KEYFRAMES
     ========================================================== */

  /* Water/deep/murk: slow diagonal drift */
  @keyframes env-drift {
    from { transform: translate(-30px, 0); }
    to   { transform: translate(0, -15px); }
  }

  /* Nature/stone: slow breathing scale */
  @keyframes env-breathe {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50%      { opacity: 1;   transform: scale(1.15); }
  }

  /* Flame/inferno: rising embers */
  @keyframes env-rise {
    0%   { transform: translateY(0);     opacity: 0.35; }
    60%  { transform: translateY(-25px); opacity: 0.5; }
    100% { transform: translateY(-50px); opacity: 0; }
  }

  /* Mystic/divine: slow rotation */
  @keyframes env-swirl {
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
  }

  /* Cosmic: twinkling stars */
  @keyframes env-twinkle {
    0%   { opacity: 0.15; }
    33%  { opacity: 0.55; }
    66%  { opacity: 0.2; }
    100% { opacity: 0.6; }
  }

  /* Crystal: sliding shimmer */
  @keyframes env-shimmer {
    0%   { background-position: 200% 200%; }
    50%  { background-position: 0% 0%; }
    100% { background-position: 200% 200%; }
  }

  /* Electric: pulsing */
  @keyframes env-pulse {
    0%, 100% { opacity: 0.15; }
    50%      { opacity: 0.45; }
  }

  .fish-detail__img-placeholder {
    width: 128px;
    height: 128px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* ============================================================
     SIDEBAR: QUICK DATA TABLE
     ============================================================ */

  .fish-detail__qd {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .fish-detail__qd-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid var(--border);
    font-size: 0.85rem;
  }

  .fish-detail__qd-row:last-child {
    border-bottom: none;
  }

  .fish-detail__qd-label {
    color: var(--text-dim);
    font-weight: 500;
  }

  .fish-detail__qd-value {
    font-weight: 600;
    color: var(--text);
    text-align: right;
  }

  /* ============================================================
     SIDEBAR: TABLE OF CONTENTS
     ============================================================ */

  .fish-detail__toc {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .fish-detail__toc-title {
    font-size: 0.65rem;
    font-weight: 600;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.25rem;
  }

  .fish-detail__toc-link {
    font-size: 0.82rem;
    color: var(--text-dim);
    padding: 0.25rem 0;
    transition: color 0.2s;
  }

  .fish-detail__toc-link:hover {
    color: var(--accent-secondary, #22D3EE);
  }

  /* ============================================================
     OVERVIEW SECTION
     ============================================================ */

  .overview {
    padding-bottom: 1.5rem;
  }

  .overview__text {
    font-size: 0.88rem;
    color: var(--text-dim);
    line-height: 1.7;
  }

  /* ============================================================
     INFO GRID
     ============================================================ */

  .info-section {
    padding-bottom: 1.5rem;
  }

  .info-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.6rem;
  }

  @media (min-width: 480px) {
    .info-grid { grid-template-columns: repeat(3, 1fr); }
  }

  @media (min-width: 768px) {
    .info-grid { grid-template-columns: repeat(3, 1fr); }
  }

  @media (min-width: 1024px) {
    .info-grid { grid-template-columns: repeat(6, 1fr); }
  }

  .info-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.15rem;
    padding: 0.75rem 0.5rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    text-align: center;
    transition: border-color 0.2s;
  }

  .info-card:hover {
    border-color: rgba(6, 214, 160, 0.3);
  }

  .info-card__icon {
    font-size: 1.25rem;
  }

  .info-card__label {
    font-size: 0.7rem;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 500;
  }

  .info-card__value {
    font-family: var(--font-display);
    font-size: 0.95rem;
    font-weight: 700;
    color: #fff;
    line-height: 1.2;
  }

  /* ============================================================
     CONDITIONS
     ============================================================ */

  .section-heading {
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .conditions {
    padding-bottom: 1.5rem;
  }

  .conditions__list {
    display: flex;
    flex-direction: column;
    gap: 0;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .cond-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.7rem 1rem;
    border-bottom: 1px solid var(--border);
  }

  .cond-row:last-child {
    border-bottom: none;
  }

  .cond-row__icon {
    font-size: 1.1rem;
    flex-shrink: 0;
    width: 1.5rem;
    text-align: center;
  }

  .cond-row__label {
    font-size: 0.8rem;
    color: var(--text-dim);
    min-width: 5.5rem;
    flex-shrink: 0;
    font-weight: 500;
  }

  .cond-row__value {
    font-size: 0.9rem;
    color: #fff;
    font-weight: 600;
  }

  .cond-row__link {
    color: var(--accent);
    transition: opacity 0.2s;
  }

  .cond-row__link:hover {
    opacity: 0.8;
  }

  /* ============================================================
     HOW TO CATCH ‚Äî ACCORDION
     ============================================================ */

  .htc-accordion {
    border: 1px solid rgba(34, 211, 238, 0.4);
    border-radius: 12px;
    background: rgba(34, 211, 238, 0.08);
    overflow: hidden;
  }

  .htc-accordion__toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    color: #22d3ee;
    list-style: none;
    transition: background 0.2s;
  }

  .htc-accordion__toggle::-webkit-details-marker { display: none; }

  .htc-accordion__toggle:hover {
    background: rgba(34, 211, 238, 0.18);
  }

  .htc-accordion__icon {
    font-size: 1.1rem;
    flex-shrink: 0;
  }

  .htc-accordion__text {
    font-family: var(--font-display);
    font-size: 0.95rem;
    font-weight: 700;
    letter-spacing: 0.04em;
  }

  .htc-accordion__chevron {
    margin-left: auto;
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  .htc-accordion[open] > .htc-accordion__toggle .htc-accordion__chevron {
    transform: rotate(180deg);
  }

  .htc-accordion__body {
    padding: 0 1rem 1rem;
    border-top: 1px solid rgba(34, 211, 238, 0.2);
    animation: htc-slide-down 0.3s ease;
  }

  @keyframes htc-slide-down {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .htc-accordion__para {
    font-size: 0.88rem;
    color: var(--text-dim);
    line-height: 1.65;
  }

  .htc-accordion__para:first-child {
    margin-top: 1rem;
  }

  .htc-accordion__para + .htc-accordion__para {
    margin-top: 0.75rem;
  }

  /* Desktop sidebar accordion */
  .htc-accordion--sidebar {
    width: 100%;
  }

  /* Mobile accordion container */
  .htc-cta-mobile-wrap {
    margin-bottom: 0.75rem;
  }

  .htc-accordion--mobile .htc-accordion__toggle {
    min-height: 48px;
  }

  .htc-accordion--mobile .htc-accordion__text {
    font-size: 1rem;
  }

  /* Mobile: show mobile, hide sidebar */
  @media (max-width: 767px) {
    .htc-accordion--sidebar {
      display: none;
    }

    .htc-accordion__para {
      font-size: 1rem;
      line-height: 1.7;
    }

    .htc-accordion__para + .htc-accordion__para {
      margin-top: 1rem;
    }
  }

  /* Desktop: hide mobile, show sidebar */
  @media (min-width: 768px) {
    .htc-cta-mobile-wrap {
      display: none;
    }
  }

  /* ============================================================
     VALUE CALCULATOR
     ============================================================ */

  .calc-section {
    padding-bottom: 1.5rem;
  }

  /* Styles for the React component */
  .calc-section :global(.calc) {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.85rem;
  }

  .calc-section :global(.calc__row) {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .calc-section :global(.calc__label) {
    font-size: 0.8rem;
    color: var(--text-dim);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .calc-section :global(.calc__input),
  .calc-section :global(.calc__select) {
    background: var(--bg-deep);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.55rem 0.75rem;
    color: var(--text);
    font-family: var(--font-body);
    font-size: 0.9rem;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    width: 100%;
  }

  .calc-section :global(.calc__input:focus),
  .calc-section :global(.calc__select:focus) {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(6, 214, 160, 0.15);
  }

  .calc-section :global(.calc__range) {
    font-size: 0.75rem;
    color: var(--text-dim);
  }

  .calc-section :global(.calc__select option) {
    background: var(--bg-card);
    color: var(--text);
  }

  .calc-section :global(.calc__result) {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.2rem;
    padding: 1rem;
    background: linear-gradient(135deg, rgba(6, 214, 160, 0.08), rgba(14, 165, 233, 0.06));
    border: 1px solid rgba(6, 214, 160, 0.2);
    border-radius: 10px;
    text-align: center;
  }

  .calc-section :global(.calc__result-label) {
    font-size: 0.75rem;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 500;
  }

  .calc-section :global(.calc__result-value) {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    line-height: 1.2;
  }

  .calc-section :global(.calc__result-formula) {
    font-size: 0.75rem;
    color: var(--text-dim);
    margin-top: 0.15rem;
  }

  @media (min-width: 640px) {
    .calc-section :global(.calc) {
      flex-direction: row;
      flex-wrap: wrap;
      align-items: flex-end;
    }
    .calc-section :global(.calc__row) {
      flex: 1;
      min-width: 160px;
    }
    .calc-section :global(.calc__result) {
      width: 100%;
    }
  }

  /* ============================================================
     TRADING VALUE
     ============================================================ */

  .trading {
    padding-bottom: 1.5rem;
  }

  .trading__card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .trading__row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.7rem 1rem;
    border-bottom: 1px solid var(--border);
  }

  .trading__row:last-child {
    border-bottom: none;
  }

  .trading__label {
    font-size: 0.85rem;
    color: var(--text-dim);
    font-weight: 500;
  }

  .trading__val {
    font-family: var(--font-display);
    font-size: 0.95rem;
    font-weight: 700;
    color: #fff;
  }

  .trading__val--highlight {
    color: var(--accent);
  }

  /* ============================================================
     DESCRIPTION
     ============================================================ */

  .desc-section {
    padding-bottom: 1.5rem;
  }

  .desc-section__text {
    font-size: 0.95rem;
    color: var(--text-dim);
    line-height: 1.7;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem 1.25rem;
  }

  /* ============================================================
     RELATED FISH
     ============================================================ */

  .related {
    padding-bottom: 1rem;
  }

  .related__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
  }

  @media (min-width: 480px) {
    .related__grid { grid-template-columns: repeat(3, 1fr); }
  }

  @media (min-width: 768px) {
    .related__grid { grid-template-columns: repeat(3, 1fr); }
  }

  @media (min-width: 1024px) {
    .related__grid { grid-template-columns: repeat(5, 1fr); }
  }

  .related__card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.3rem;
    padding: 0.65rem 0.75rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    transition: border-color 0.2s, transform 0.2s;
    text-align: center;
  }

  .related__card:hover {
    border-color: rgba(6, 214, 160, 0.35);
    transform: translateY(-1px);
  }

  .related__img-wrap {
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .related__img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  .related__img-placeholder {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--bg-deep, rgba(255, 255, 255, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .related__name {
    font-size: 0.85rem;
    font-weight: 600;
    color: #fff;
    line-height: 1.3;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 100%;
  }

  .related__value {
    font-size: 0.75rem;
    color: var(--text-dim);
    font-family: var(--font-display);
  }

  .related__see-all {
    display: inline-block;
    margin-top: 0.65rem;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--accent);
    transition: opacity 0.2s;
  }

  .related__see-all:hover {
    opacity: 0.8;
  }

  /* ============================================================
     QUICK LINKS
     ============================================================ */

  .quick-links {
    padding-bottom: 1.5rem;
  }

  .quick-links__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
  }

  @media (min-width: 640px) {
    .quick-links__grid { grid-template-columns: repeat(4, 1fr); }
  }

  .quick-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.65rem 0.85rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    font-size: 0.82rem;
    font-weight: 500;
    color: var(--text);
    transition: border-color 0.2s, transform 0.2s;
  }

  .quick-link:hover {
    border-color: rgba(6, 214, 160, 0.35);
    transform: translateY(-1px);
  }

  .quick-link__icon {
    font-size: 1rem;
    flex-shrink: 0;
  }

  .quick-link__text {
    line-height: 1.3;
  }

  /* ============================================================
     MOBILE POLISH
     ============================================================ */

  /* Smooth scroll for anchor links */
  :global(html) {
    scroll-behavior: smooth;
  }

  /* Mobile: conditions full width, readable text */
  @media (max-width: 767px) {
    .cond-row__value {
      font-size: 0.85rem;
    }

    .overview__text {
      font-size: 1rem;
      line-height: 1.7;
    }

    .desc-section__text {
      font-size: 1rem;
      line-height: 1.7;
      padding: 1rem;
    }
  }
</style>
